<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ÃœskÃ¼dar Ãœniversitesi - HaftalÄ±k Etkinlik ProgramÄ±</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #1a5f5f 0%, #2a7a7a 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.2);
            overflow: hidden;
        }

        .header-section {
            background: linear-gradient(135deg, #1a5f5f 0%, #2a7a7a 100%);
            color: white;
            padding: 25px 30px;
            text-align: center;
        }

        .header-section h1 {
            font-size: 22px;
            margin-bottom: 8px;
            font-weight: bold;
        }

        .header-section p {
            font-size: 16px;
            margin: 5px 0;
        }

        .form-section {
            padding: 25px 30px;
            background: white;
        }

        .form-section h2 {
            color: #1a5f5f;
            margin-bottom: 20px;
            font-size: 20px;
            border-bottom: 2px solid #1a5f5f;
            padding-bottom: 10px;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-bottom: 15px;
        }

        .form-group {
            margin-bottom: 12px;
        }

        .form-group.full-width {
            grid-column: 1 / -1;
        }

        .form-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: 600;
            color: #1a5f5f;
            font-size: 13px;
        }

        .form-group input,
        .form-group select {
            width: 100%;
            padding: 10px 12px;
            border: 2px solid #e0e0e0;
            border-radius: 6px;
            font-size: 14px;
            transition: all 0.3s;
            background: white;
        }

        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: #1a5f5f;
            box-shadow: 0 0 0 3px rgba(26, 95, 95, 0.1);
        }

        .form-group input[readonly] {
            background: #f8f9fa;
            cursor: not-allowed;
        }

        .form-group small {
            display: block;
            color: #666;
            font-size: 11px;
            margin-top: 4px;
        }

        .logo-preview {
            text-align: center;
            padding: 12px;
            background: #f8f9fa;
            border-radius: 6px;
            min-height: 55px;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 2px dashed #e0e0e0;
        }

        .logo-preview img {
            max-width: 50px;
            max-height: 50px;
            object-fit: contain;
        }

        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 0;
        }

        .checkbox-group input[type="checkbox"] {
            width: auto;
            margin: 0;
        }

        .checkbox-group label {
            margin: 0;
            font-weight: normal;
            cursor: pointer;
        }

        .button-group {
            display: flex;
            gap: 10px;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 10px 24px;
            border: none;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-primary {
            background: #1a5f5f;
            color: white;
        }

        .btn-primary:hover {
            background: #2a7a7a;
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(26, 95, 95, 0.3);
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-secondary:hover {
            background: #5a6268;
        }

        .events-list {
            margin-top: 30px;
        }

        /* 7 GÃ¼nlÃ¼k Renk TemalarÄ± - TasarÄ±ma Birebir Uyumlu */
        .day-section.pazartesi {
            --day-color: #e74c3c;
            --day-light: #fadbd8;
        }
        .day-section.sali {
            --day-color: #f39c12;
            --day-light: #fdebd0;
        }
        .day-section.carsamba {
            --day-color: #f1c40f;
            --day-light: #fef9e7;
        }
        .day-section.persembe {
            --day-color: #2ecc71;
            --day-light: #d5f4e6;
        }
        .day-section.cuma {
            --day-color: #3498db;
            --day-light: #d6eaf8;
        }
        .day-section.cumartesi {
            --day-color: #9b59b6;
            --day-light: #ebdef0;
        }
        .day-section.pazar {
            --day-color: #e67e22;
            --day-light: #fae5d3;
        }

        .day-section {
            margin-bottom: 25px;
            background: var(--day-light);
            border-radius: 8px;
            padding: 15px;
            border-left: 5px solid var(--day-color);
        }

        .day-header {
            background-color: var(--day-color);
            color: white;
            padding: 12px 18px;
            border-radius: 6px;
            margin-bottom: 12px;
            font-weight: bold;
            font-size: 16px;
            cursor: pointer;
        }

        .day-header:hover {
            opacity: 0.95;
        }

        .events-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 12px;
        }

        /* TasarÄ±ma Birebir Uyumlu Event KartlarÄ± - Yatay DÃ¼zen (Ä°kon Solda, Metin SaÄŸda) */
        .event-card {
            background: white;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            padding: 12px;
            position: relative;
            transition: all 0.3s;
            cursor: move;
            display: flex;
            align-items: flex-start;
            gap: 12px;
        }

        .event-card:hover {
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            transform: translateY(-2px);
            border-color: var(--day-color);
        }

        .event-card.dragging {
            opacity: 0.5;
        }

        .event-card .club-icon {
            flex-shrink: 0;
            width: 50px;
            height: 50px;
            background: #f0f0f0;
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 5px;
        }
        
        .event-card .club-icon img {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }

        .event-card .event-content {
            flex: 1;
            min-width: 0;
        }

        .event-card .club-name {
            font-size: 10px;
            color: #666;
            font-weight: 600;
            margin-bottom: 4px;
            line-height: 1.3;
        }

        .event-card .event-title {
            font-size: 13px;
            color: #1a5f5f;
            font-weight: bold;
            margin-bottom: 6px;
            line-height: 1.4;
        }

        .event-card .event-time,
        .event-card .event-location {
            font-size: 11px;
            margin-bottom: 3px;
            cursor: text;
            padding: 2px 4px;
            border-radius: 3px;
            transition: background 0.2s;
        }

        .event-card .event-time {
            color: #333;
        }

        .event-card .event-location {
            color: #4a90e2;
        }

        .event-card .event-location.online {
            color: #ff6b6b;
        }

        .event-card .event-time:hover,
        .event-card .event-location:hover {
            background: #f0f0f0;
        }

        .event-card .delete-btn {
            position: absolute;
            top: 6px;
            right: 6px;
            background: #dc3545;
            color: white;
            border: none;
            border-radius: 50%;
            width: 22px;
            height: 22px;
            cursor: pointer;
            font-size: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transition: opacity 0.3s;
        }

        .event-card:hover .delete-btn {
            opacity: 1;
        }

        .event-card input[type="text"] {
            width: 100%;
            border: 1px solid #ffc107;
            padding: 4px;
            border-radius: 3px;
            font-size: inherit;
            font-family: inherit;
        }

        @media (max-width: 768px) {
            .form-grid {
                grid-template-columns: 1fr;
            }
            .events-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header-section">
            <h1>ÃœSKÃœDAR ÃœNÄ°VERSÄ°TESÄ°</h1>
            <p>SAÄLIK, KÃœLTÃœR VE SPOR DAÄ°RE BAÅKANLIÄI</p>
            <p style="margin-top: 8px; font-size: 14px; opacity: 0.9;">HaftalÄ±k Etkinlik ProgramÄ± OluÅŸturucu</p>
        </div>

        <div class="form-section">
            <h2>Etkinlik Ekle</h2>
            
            <div class="form-grid">
                <div class="form-group">
                    <label>Tarih AralÄ±ÄŸÄ± - BaÅŸlangÄ±Ã§</label>
                    <input type="text" id="startDate" placeholder="Ã¶rn: 22 ARALIK" value="22 ARALIK">
                </div>
                <div class="form-group">
                    <label>Tarih AralÄ±ÄŸÄ± - BitiÅŸ</label>
                    <input type="text" id="endDate" placeholder="Ã¶rn: 28 ARALIK" value="28 ARALIK">
                </div>
                <div class="form-group">
                    <label>GÃ¼n</label>
                    <select id="daySelect" onchange="suggestDateForDay()">
                        <option value="">SeÃ§in...</option>
                        <option value="Pazartesi">Pazartesi</option>
                        <option value="SalÄ±">SalÄ±</option>
                        <option value="Ã‡arÅŸamba">Ã‡arÅŸamba</option>
                        <option value="PerÅŸembe">PerÅŸembe</option>
                        <option value="Cuma">Cuma</option>
                        <option value="Cumartesi">Cumartesi</option>
                        <option value="Pazar">Pazar</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Tarih</label>
                    <input type="date" id="fullDate" onchange="formatSelectedDate()">
                </div>
                <div class="form-group">
                    <label>Tarih (FormatlÄ±)</label>
                    <input type="text" id="fullDateFormatted" placeholder="Otomatik doldurulacak" readonly>
                </div>
                <div class="form-group full-width">
                    <label>KulÃ¼p</label>
                    <input type="text" id="clubName" placeholder="KulÃ¼p seÃ§in veya yazÄ±n..." list="clubList" autocomplete="off" oninput="filterClubList()">
                    <datalist id="clubList"></datalist>
                </div>
                <div class="form-group">
                    <label>Logo Ã–nizleme</label>
                    <div class="logo-preview" id="logoPreview">
                        <span style="font-size: 28px;">ğŸ¯</span>
                    </div>
                </div>
                <div class="form-group full-width">
                    <label>Etkinlik BaÅŸlÄ±ÄŸÄ±</label>
                    <input type="text" id="eventTitle" placeholder="Ã¶rn: YeryÃ¼zÃ¼ne Dokun">
                </div>
                <div class="form-group">
                    <label>Saat</label>
                    <select id="eventTime">
                        <option value="">SeÃ§in...</option>
                    </select>
                </div>
                <div class="form-group full-width">
                    <label>Konum / Salon</label>
                    <input type="text" id="eventLocation" placeholder="Ã¶rn: Fuat Sezgin Salonu">
                </div>
                <div class="form-group">
                    <label>YerleÅŸke</label>
                    <select id="campusSelect">
                        <option value="">SeÃ§in...</option>
                        <option value="Merkez YerleÅŸkesi">Merkez YerleÅŸkesi</option>
                        <option value="GÃ¼ney YerleÅŸkesi">GÃ¼ney YerleÅŸkesi</option>
                        <option value="SaÄŸlÄ±k YerleÅŸkesi">SaÄŸlÄ±k YerleÅŸkesi</option>
                        <option value="Ã‡arÅŸÄ± YerleÅŸkesi">Ã‡arÅŸÄ± YerleÅŸkesi</option>
                        <option value="DiÄŸer">DiÄŸer</option>
                    </select>
                </div>
                <div class="form-group full-width">
                    <div class="checkbox-group">
                        <input type="checkbox" id="isOnline">
                        <label for="isOnline">Ã‡evrimiÃ§i Etkinlik (ZOOM)</label>
                    </div>
                </div>
            </div>

            <div class="button-group">
                <button class="btn btn-primary" onclick="addEvent()">â• Etkinlik Ekle</button>
                <button class="btn btn-secondary" onclick="clearForm()">ğŸ”„ Formu Temizle</button>
            </div>

            <div class="events-list" id="eventsList"></div>
            
            <div class="button-group" style="margin-top: 30px; justify-content: center;">
                <button class="btn btn-success" onclick="convertToDesign()" style="background: #28a745; padding: 12px 30px; font-size: 16px;">ğŸ¨ TasarÄ±ma DÃ¶nÃ¼ÅŸtÃ¼r</button>
                <button class="btn btn-primary" onclick="downloadDesign()" id="downloadBtn" style="display: none; background: #1a5f5f;">ğŸ’¾ TasarÄ±mÄ± Ä°ndir</button>
                <button class="btn btn-info" onclick="exportEventsToJSON()" style="background:#17a2b8; color:white;">ğŸ“¤ Etkinlikleri JSON'a Aktar</button>
                <button class="btn btn-secondary" onclick="document.getElementById('eventsJsonInput').click()" style="background:#6c757d; color:white;">ğŸ“¥ JSON'dan Etkinlik YÃ¼kle</button>
                <input type="file" id="eventsJsonInput" accept="application/json" style="display:none;" onchange="importEventsFromJSONFile(event)">
            </div>

            <!-- Bulut Senkron (Ãœcretsiz DB: Supabase) -->
            <div style="margin-top: 20px; padding: 14px; border: 2px dashed #cfe2ff; background: #eef5ff; border-radius: 10px;">
                <div style="font-weight: 800; color:#0b4aa2; margin-bottom: 8px;">â˜ï¸ Bulut Senkron (Supabase - Ãœcretsiz)</div>
                <div style="font-size: 12px; color:#234; line-height: 1.5; margin-bottom: 10px;">
                    Bu bÃ¶lÃ¼m, etkinlikleri tarayÄ±cÄ± yenilense bile <b>ortak bir online veritabanÄ±nda</b> saklamanÄ±zÄ± saÄŸlar.
                    <br><b>Not:</b> GÃ¼venlik iÃ§in Supabaseâ€™de RLS/policy ayarlamanÄ±z Ã¶nerilir.
                </div>
                <div style="display:grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                    <div>
                        <div style="font-size:12px; font-weight:700; margin-bottom:4px;">Supabase URL</div>
                        <input id="supabaseUrl" type="text" placeholder="https://xxxx.supabase.co" style="width:100%; padding:10px; border:2px solid #cfe2ff; border-radius:8px; font-size:13px;">
                    </div>
                    <div>
                        <div style="font-size:12px; font-weight:700; margin-bottom:4px;">Anon Key</div>
                        <input id="supabaseAnonKey" type="password" placeholder="eyJhbGciOi..." style="width:100%; padding:10px; border:2px solid #cfe2ff; border-radius:8px; font-size:13px;">
                    </div>
                </div>
                <div style="display:grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 10px;">
                    <div>
                        <div style="font-size:12px; font-weight:700; margin-bottom:4px;">Admin Email</div>
                        <input id="supabaseEmail" type="email" placeholder="ornek@uskudar.edu.tr" style="width:100%; padding:10px; border:2px solid #cfe2ff; border-radius:8px; font-size:13px;">
                    </div>
                    <div>
                        <div style="font-size:12px; font-weight:700; margin-bottom:4px;">Åifre</div>
                        <input id="supabasePassword" type="password" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" style="width:100%; padding:10px; border:2px solid #cfe2ff; border-radius:8px; font-size:13px;">
                    </div>
                </div>
                <div style="display:flex; gap:10px; flex-wrap:wrap; margin-top: 12px; align-items:center;">
                    <button class="btn btn-info" onclick="saveSupabaseConfig()" style="background:#0d6efd; color:white;">ğŸ’¾ AyarlarÄ± Kaydet</button>
                    <button class="btn btn-primary" onclick="supabaseAuthLogin()" style="background:#0b5ed7; color:white;">ğŸ” GiriÅŸ</button>
                    <button class="btn btn-secondary" onclick="supabaseAuthLogout()" style="background:#adb5bd; color:#1b1f23;">ğŸšª Ã‡Ä±kÄ±ÅŸ</button>
                    <button class="btn btn-secondary" onclick="cloudPullEvents()" style="background:#6c757d; color:white;">â¬‡ï¸ Buluttan Ã‡ek</button>
                    <button class="btn btn-success" onclick="cloudPushEvents()" style="background:#198754; color:white;">â¬†ï¸ Buluta GÃ¶nder</button>
                    <label style="display:flex; align-items:center; gap:8px; font-size:12px; color:#234; padding:6px 10px; background:#fff; border-radius:8px; border:1px solid #cfe2ff;">
                        <input type="checkbox" id="cloudAutoSync" onchange="toggleCloudAutoSync()" />
                        Otomatik senkron
                    </label>
                    <span id="cloudSyncStatus" style="font-size:12px; color:#234; opacity:0.9;"></span>
                    <span id="cloudAuthStatus" style="font-size:12px; color:#234; opacity:0.9;"></span>
                </div>
            </div>
            
            <!-- Logo YÃ¶netimi -->
            <div style="margin-top: 20px; padding: 15px; background: #e7f3ff; border-radius: 8px; border-left: 4px solid #1a5f5f;">
                <h3 style="color: #1a5f5f; margin-bottom: 10px; font-size: 16px;">ğŸ“ Logo YÃ¶netimi</h3>
                <p style="color: #333; font-size: 13px; margin-bottom: 10px;">
                    Yeni logo eklemek veya mevcut logolarÄ± dÃ¼zenlemek iÃ§in:
                </p>
                <button class="btn btn-primary" onclick="openLogoManager()" style="background: #1a5f5f; padding: 10px 20px; font-size: 14px; margin-top: 10px;">âš™ï¸ Logo YÃ¶netim Paneli</button>
            </div>
            
            <!-- Logo YÃ¶netim Modal -->
            <div id="logoManagerModal" style="display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.7); z-index: 10000; align-items: center; justify-content: center; padding: 20px; overflow-y: auto;">
                <div style="background: white; border-radius: 12px; max-width: 800px; width: 100%; max-height: 90vh; overflow-y: auto; position: relative;">
                    <div style="padding: 20px; border-bottom: 2px solid #e0e0e0; display: flex; justify-content: space-between; align-items: center; background: #1a5f5f; color: white; border-radius: 12px 12px 0 0;">
                        <h2 style="margin: 0; color: white; font-size: 20px;">ğŸ¨ Logo YÃ¶netim Paneli</h2>
                        <button onclick="closeLogoManager()" style="background: #dc3545; color: white; border: none; border-radius: 50%; width: 30px; height: 30px; cursor: pointer; font-size: 18px;">Ã—</button>
                    </div>
                    <div style="padding: 20px;">
                        <!-- Logo Boyut Bilgisi -->
                        <div style="background: #fff3cd; border: 2px solid #ffc107; border-radius: 8px; padding: 15px; margin-bottom: 20px;">
                            <h3 style="color: #856404; margin: 0 0 10px 0; font-size: 16px;">ğŸ“ Logo Boyut Ã–nerileri</h3>
                            <ul style="margin: 0; padding-left: 20px; color: #856404; font-size: 13px;">
                                <li><strong>Ã–nerilen Boyut:</strong> 300x300 piksel (1:1 kare format)</li>
                                <li><strong>Minimum Boyut:</strong> 200x200 piksel</li>
                                <li><strong>Maksimum Boyut:</strong> 512x512 piksel</li>
                                <li><strong>Format:</strong> PNG (ÅŸeffaf arka plan Ã¶nerilir)</li>
                                <li><strong>Dosya Boyutu:</strong> Maksimum 500 KB (optimize edilmiÅŸ)</li>
                            </ul>
                        </div>
                        
                        <div class="form-group">
                            <label style="display: flex; justify-content: space-between; align-items: center;">
                                <span>KulÃ¼p SeÃ§in</span>
                                <button onclick="showAddClubModal()" style="background: #17a2b8; color: white; border: none; padding: 5px 12px; border-radius: 4px; cursor: pointer; font-size: 12px;">+ Yeni KulÃ¼p Ekle</button>
                            </label>
                            <select id="logoManagerClubSelect" style="width: 100%; padding: 10px; border: 2px solid #e0e0e0; border-radius: 6px; font-size: 14px;">
                                <option value="">KulÃ¼p seÃ§in...</option>
                            </select>
                            <div style="margin-top: 8px; display: flex; gap: 5px;">
                                <button onclick="editSelectedClub()" style="flex: 1; background: #ffc107; color: #333; border: none; padding: 6px; border-radius: 4px; cursor: pointer; font-size: 12px;">âœï¸ DÃ¼zenle</button>
                                <button onclick="deleteSelectedClub()" style="flex: 1; background: #dc3545; color: white; border: none; padding: 6px; border-radius: 4px; cursor: pointer; font-size: 12px;">ğŸ—‘ï¸ Sil</button>
                            </div>
                        </div>
                        
                        <!-- Yeni KulÃ¼p Ekleme/DÃ¼zenleme Modal -->
                        <div id="addClubModal" style="display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.7); z-index: 10001; align-items: center; justify-content: center; padding: 20px;">
                            <div style="background: white; border-radius: 12px; max-width: 500px; width: 100%; position: relative;">
                                <div style="padding: 20px; border-bottom: 2px solid #e0e0e0; display: flex; justify-content: space-between; align-items: center; background: #1a5f5f; color: white; border-radius: 12px 12px 0 0;">
                                    <h2 style="margin: 0; color: white; font-size: 18px;" id="addClubModalTitle">â• Yeni KulÃ¼p Ekle</h2>
                                    <button onclick="closeAddClubModal()" style="background: #dc3545; color: white; border: none; border-radius: 50%; width: 30px; height: 30px; cursor: pointer; font-size: 18px;">Ã—</button>
                                </div>
                                <div style="padding: 20px;">
                                    <div class="form-group">
                                        <label>KulÃ¼p AdÄ±</label>
                                        <input type="text" id="newClubName" placeholder="Ã¶rn: Yeni KulÃ¼p AdÄ±" style="width: 100%; padding: 10px; border: 2px solid #e0e0e0; border-radius: 6px; font-size: 14px;">
                                    </div>
                                    <div style="display: flex; gap: 10px; margin-top: 20px;">
                                        <button onclick="saveNewClub()" style="flex: 1; background: #28a745; color: white; border: none; padding: 10px; border-radius: 6px; cursor: pointer; font-size: 14px;">ğŸ’¾ Kaydet</button>
                                        <button onclick="closeAddClubModal()" style="flex: 1; background: #6c757d; color: white; border: none; padding: 10px; border-radius: 6px; cursor: pointer; font-size: 14px;">Ä°ptal</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Dosya YÃ¼kleme AlanÄ± -->
                        <div class="form-group" style="margin-top: 15px;">
                            <label>Logo DosyasÄ± YÃ¼kle</label>
                            <div id="logoUploadArea" style="border: 3px dashed #1a5f5f; border-radius: 8px; padding: 30px; text-align: center; background: #f8f9fa; cursor: pointer; transition: all 0.3s;" 
                                 ondrop="handleLogoDrop(event)" ondragover="handleDragOver(event)" ondragleave="handleDragLeave(event)" onclick="document.getElementById('logoFileInput').click()">
                                <input type="file" id="logoFileInput" accept="image/png,image/jpeg,image/jpg" style="display: none;" onchange="handleLogoFileSelect(event)">
                                <div id="uploadAreaContent">
                                    <div style="font-size: 48px; margin-bottom: 10px;">ğŸ“¤</div>
                                    <div style="color: #1a5f5f; font-weight: bold; margin-bottom: 5px;">Logo DosyasÄ±nÄ± SÃ¼rÃ¼kleyip BÄ±rakÄ±n</div>
                                    <div style="color: #666; font-size: 13px;">veya tÄ±klayarak seÃ§in</div>
                                    <div style="color: #999; font-size: 12px; margin-top: 8px;">PNG, JPG formatlarÄ± desteklenir</div>
                                </div>
                            </div>
                        </div>

                        <!-- Toplu Logo Ä°Ã§e AktarÄ±m (KlasÃ¶r) -->
                        <div class="form-group" style="margin-top: 15px;">
                            <label>Toplu Logo Ä°Ã§e Aktar (KlasÃ¶r SeÃ§)</label>
                            <div style="display:flex; gap:10px; align-items:center; flex-wrap: wrap;">
                                <input type="file" id="logoFolderInput" style="display:none;" webkitdirectory directory multiple accept="image/png,image/jpeg,image/jpg" onchange="handleLogoFolderSelect(event)">
                                <button onclick="document.getElementById('logoFolderInput').click()" style="background:#1a5f5f; color:white; border:none; padding:10px 14px; border-radius:6px; cursor:pointer; font-size:13px;">
                                    ğŸ“‚ KlasÃ¶r SeÃ§ (Toplu)
                                </button>
                                <span id="bulkImportStatus" style="color:#666; font-size:12px;"></span>
                            </div>
                            <small style="color:#666; display:block; margin-top:6px; line-height:1.5;">
                                <strong>Neden gerekli?</strong> Chrome, <code>file://</code> altÄ±nda PNGâ€™leri canvasâ€™a Ã§izdirmediÄŸi iÃ§in indirme boÅŸ Ã§Ä±kabiliyor.
                                KlasÃ¶rden iÃ§e aktarÄ±nca logolar <strong>base64</strong> olarak kaydedilir ve â€œTasarÄ±mÄ± Ä°ndirâ€ stabil Ã§alÄ±ÅŸÄ±r.
                            </small>
                        </div>

                        <!-- Header LogolarÄ± (ÃœÃœ / SKS) -->
                        <div class="form-group" style="margin-top: 15px;">
                            <label>Header LogolarÄ± (ÃœÃœ / SKS)</label>
                            <div style="display:grid; grid-template-columns: 1fr 1fr; gap: 12px;">
                                <div style="border:1px solid #e0e0e0; border-radius: 8px; padding: 12px;">
                                    <div style="font-weight:600; color:#1a5f5f; margin-bottom:8px;">ÃœÃœ (Sol Ãœst)</div>
                                    <input type="file" id="headerUULogoInput" accept="image/png,image/jpeg,image/jpg" onchange="handleHeaderLogoSelect('uu', event)" style="width:100%; font-size:12px;">
                                    <div id="headerUULogoPreview" style="margin-top:10px; width: 110px; height: 110px; border-radius: 50%; overflow:hidden; background:#f8f9fa; border:2px dashed #e0e0e0; display:flex; align-items:center; justify-content:center;">
                                        <span style="color:#999; font-size:12px;">ÃœÃœ</span>
                                    </div>
                                </div>
                                <div style="border:1px solid #e0e0e0; border-radius: 8px; padding: 12px;">
                                    <div style="font-weight:600; color:#1a5f5f; margin-bottom:8px;">SKS (SaÄŸ Ãœst)</div>
                                    <input type="file" id="headerSKSLogoInput" accept="image/png,image/jpeg,image/jpg" onchange="handleHeaderLogoSelect('sks', event)" style="width:100%; font-size:12px;">
                                    <div id="headerSKSLogoPreview" style="margin-top:10px; width: 110px; height: 110px; border-radius: 50%; overflow:hidden; background:#f8f9fa; border:2px dashed #e0e0e0; display:flex; align-items:center; justify-content:center;">
                                        <span style="color:#999; font-size:12px;">SKS</span>
                                    </div>
                                </div>
                            </div>
                            <div style="display:flex; gap:10px; margin-top:12px;">
                                <button onclick="clearHeaderLogos()" style="background:#dc3545; color:white; border:none; padding:8px 12px; border-radius:6px; cursor:pointer; font-size:12px;">
                                    ğŸ—‘ï¸ Header LogolarÄ±nÄ± Temizle
                                </button>
                                <span style="color:#666; font-size:12px; align-self:center;">Bu logolar base64 olarak kaydedilir ve indirmede sorunsuz gÃ¶rÃ¼nÃ¼r.</span>
                            </div>
                        </div>
                        
                        <!-- Dosya AdÄ± GiriÅŸi -->
                        <div class="form-group" style="margin-top: 15px;">
                            <label>Logo Dosya AdÄ± (logos/ klasÃ¶rÃ¼nden)</label>
                            <div style="display: flex; gap: 10px;">
                                <input type="text" id="logoManagerFileName" placeholder="Ã¶rn: genc-yeryuzu-doktorlari.png" style="flex: 1; padding: 10px; border: 2px solid #e0e0e0; border-radius: 6px; font-size: 14px;">
                                <button onclick="generateFileNameFromClub()" style="padding: 10px 15px; background: #17a2b8; color: white; border: none; border-radius: 6px; cursor: pointer; white-space: nowrap; font-size: 13px;">ğŸ“ Otomatik Ä°sim</button>
                            </div>
                            <small style="color: #666; display: block; margin-top: 5px;">
                                <strong>KullanÄ±m:</strong> Logos klasÃ¶rÃ¼ne dosyayÄ± kopyalayÄ±n, sonra dosya adÄ±nÄ± buraya yazÄ±n.<br>
                                <strong>Ã–rnek:</strong> logos/milli-miras.png â†’ "milli-miras.png" yazÄ±n
                            </small>
                        </div>
                        
                        <!-- Logo Bilgileri -->
                        <div id="logoInfo" style="display: none; margin-top: 15px; padding: 12px; background: #e7f3ff; border-radius: 6px; border-left: 4px solid #1a5f5f;">
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; font-size: 12px;">
                                <div><strong>Boyut:</strong> <span id="logoSizeInfo">-</span></div>
                                <div><strong>Dosya Boyutu:</strong> <span id="logoFileSizeInfo">-</span></div>
                                <div><strong>Format:</strong> <span id="logoFormatInfo">-</span></div>
                                <div><strong>Oran:</strong> <span id="logoRatioInfo">-</span></div>
                            </div>
                        </div>
                        
                        <!-- Logo Ã–nizleme -->
                        <div class="form-group" style="margin-top: 15px;">
                            <label>Logo Ã–nizleme</label>
                            <div id="logoManagerPreview" style="text-align: center; padding: 20px; background: #f8f9fa; border-radius: 6px; min-height: 150px; display: flex; align-items: center; justify-content: center; border: 2px dashed #e0e0e0;">
                                <span style="color: #999;">Logo Ã¶nizlemesi burada gÃ¶rÃ¼necek</span>
                            </div>
                        </div>
                        <!-- KullanÄ±m TalimatlarÄ± -->
                        <div style="margin-top: 20px; padding: 15px; background: #e7f3ff; border-radius: 8px; border-left: 4px solid #1a5f5f;">
                            <h4 style="color: #1a5f5f; margin: 0 0 10px 0; font-size: 14px;">ğŸ“– NasÄ±l KullanÄ±lÄ±r?</h4>
                            <ol style="margin: 0; padding-left: 20px; color: #333; font-size: 12px; line-height: 1.8;">
                                <li><strong>KulÃ¼p seÃ§in</strong> - Dropdown'dan kulÃ¼bÃ¼ seÃ§in</li>
                                <li><strong>Logo yÃ¼kleyin</strong> - DosyayÄ± sÃ¼rÃ¼kleyip bÄ±rakÄ±n veya tÄ±klayarak seÃ§in</li>
                                <li><strong>DosyayÄ± logos/ klasÃ¶rÃ¼ne kopyalayÄ±n</strong> - SeÃ§tiÄŸiniz dosyayÄ± <code>logos/</code> klasÃ¶rÃ¼ne kopyalayÄ±n</li>
                                <li><strong>Dosya adÄ±nÄ± kontrol edin</strong> - Otomatik oluÅŸturulan ismi kontrol edin veya dÃ¼zenleyin</li>
                                <li><strong>Kaydet</strong> - EÅŸleÅŸtirmeyi kaydedin</li>
                            </ol>
                            <div style="margin-top: 10px; padding: 10px; background: #fff; border-radius: 4px; font-size: 11px; color: #666;">
                                <strong>ğŸ’¡ Ä°pucu:</strong> Dosya adÄ±nda TÃ¼rkÃ§e karakter ve boÅŸluk kullanmayÄ±n. Sistem otomatik olarak dÃ¼zenler.
                            </div>
                        </div>
                        
                        <div style="display: flex; gap: 10px; margin-top: 20px;">
                            <button class="btn btn-primary" onclick="saveLogoMapping()" style="flex: 1; background: #28a745;">ğŸ’¾ Kaydet</button>
                            <button class="btn btn-info" onclick="exportLogosToJSON()" style="flex: 1; background: #17a2b8; color: white;">ğŸ“¥ JSON'a Aktar (GitHub iÃ§in)</button>
                            <button class="btn btn-secondary" onclick="closeLogoManager()" style="flex: 1;">Ä°ptal</button>
                        </div>
                        
                        <!-- Export Bilgisi -->
                        <div style="margin-top: 15px; padding: 12px; background: #d1ecf1; border-radius: 6px; border-left: 4px solid #17a2b8;">
                            <h4 style="color: #0c5460; margin: 0 0 8px 0; font-size: 13px;">ğŸ“¦ GitHub iÃ§in Export</h4>
                            <p style="color: #0c5460; font-size: 11px; margin: 0; line-height: 1.6;">
                                <strong>Ã–nemli:</strong> LogolarÄ± GitHub'a yÃ¼klemek iÃ§in "JSON'a Aktar" butonuna tÄ±klayÄ±n. 
                                Ä°ndirilen <code>logos.json</code> dosyasÄ±nÄ± GitHub repository'nize yÃ¼kleyin. 
                                BÃ¶ylece herkes aynÄ± logolarÄ± gÃ¶rebilir.
                            </p>
                        </div>
                        <div style="margin-top: 30px; padding-top: 20px; border-top: 2px solid #e0e0e0;">
                            <h3 style="color: #1a5f5f; margin-bottom: 15px; font-size: 16px;">ğŸ“‹ Mevcut Logo EÅŸleÅŸtirmeleri</h3>
                            <div id="logoMappingsList" style="max-height: 300px; overflow-y: auto;">
                                <!-- Logo eÅŸleÅŸtirmeleri buraya eklenecek -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- TasarÄ±m Ã–nizleme -->
            <div id="designPreview" style="display: none; margin-top: 30px; padding: 40px 20px; background: #f8f9fa; border-radius: 8px;"></div>
        </div>
    </div>

    <script>
        // KulÃ¼p Listesi (ResmÃ® Liste) â€” seÃ§imde sadece bu adlar gÃ¶sterilir.
        // Not: AÅŸaÄŸÄ±daki ALIAS tablosu, eski/kÄ±sa isimleri otomatik olarak bu resmÃ® adlara dÃ¶nÃ¼ÅŸtÃ¼rmek iÃ§in kullanÄ±lÄ±r.
        const OFFICIAL_CLUB_NAMES = [
            'Acil Durum Ve Afet YÃ¶netimi KulÃ¼bÃ¼',
            'Anestezi KulÃ¼bÃ¼',
            'Beslenme Ve Diyetetik KulÃ¼bÃ¼',
            'Bikutu ve Rol Yapma OyunlarÄ± KulÃ¼bÃ¼',
            'Bilimsel AraÅŸtÄ±rma KulÃ¼bÃ¼ (ÃœSKÃœBAT)',
            'BiyomÃ¼hendislik KulÃ¼bÃ¼',
            'BÃ¼yÃ¼dÃ¼m Ã‡ocuk Oldum KulÃ¼bÃ¼',
            'Chemical Engineering Society KulÃ¼bÃ¼',
            'Codyle KulÃ¼bÃ¼',
            'Ã‡aÄŸÄ±n VicdanÄ± KulÃ¼bÃ¼',
            'Ã‡ocuk GeliÅŸimi KulÃ¼bÃ¼',
            'Pozitif Psikoloji KulÃ¼bÃ¼',
            'Dans KulÃ¼bÃ¼',
            'Proje GeliÅŸtirme ve GenÃ§lik KulÃ¼bÃ¼',
            'Developer Student Club',
            'Dil ve KonuÅŸma Terapisi KulÃ¼bÃ¼',
            'DiÅŸ HekimliÄŸi Ã–ÄŸrenci BirliÄŸi KulÃ¼bÃ¼',
            'Pixel KulÃ¼bÃ¼',
            'EkoVizyon KulÃ¼bÃ¼',
            'EndÃ¼stri Ve Liderlik KulÃ¼bÃ¼',
            'Erasmus Community KulÃ¼bÃ¼ (Erasmus KulÃ¼bÃ¼)',
            'Ergoterapi KulÃ¼bÃ¼',
            'Fikir ve Aksiyon KulÃ¼bÃ¼',
            'Finansal OkuryazarlÄ±k KulÃ¼bÃ¼',
            'Fizyoterapi KulÃ¼bÃ¼',
            'Fizyoterapi ve Rehabilitasyon KulÃ¼bÃ¼',
            'Gazetecilik KulÃ¼bÃ¼',
            'GenÃ§ Ä°letiÅŸimciler KulÃ¼bÃ¼',
            'GenÃ§ TÄ±bbiyeliler KulÃ¼bÃ¼',
            'GenÃ§ YeryÃ¼zÃ¼ DoktorlarÄ± KulÃ¼bÃ¼',
            'GenÃ§lik KulÃ¼bÃ¼',
            'Senaryo BazlÄ± Ä°sg UygulamalarÄ± KulÃ¼bÃ¼',
            'HavacÄ±lÄ±k ve GiriÅŸimcilik KulÃ¼bÃ¼',
            'Haydi Tut Elimi KulÃ¼bÃ¼',
            'SaÄŸlÄ±k YÃ¶netimi KulÃ¼bÃ¼',
            'Hekimlik ve GeliÅŸim KulÃ¼bÃ¼',
            'HemÅŸirelik KulÃ¼bÃ¼',
            'IEEE ÃœÃœ. Ã–ÄŸr. Kolu KulÃ¼bÃ¼',
            'Sosyal Hizmet KulÃ¼bÃ¼',
            'Intercultural KulÃ¼bÃ¼',
            'Ä°yiliÄŸin GeleceÄŸi KulÃ¼bÃ¼',
            'Sinema KulÃ¼bÃ¼',
            'Kalite KulÃ¼bÃ¼',
            'KÄ±zÄ±lay KulÃ¼bÃ¼',
            'KÃ¶k HÃ¼cre ve Genetik AraÅŸtÄ±rmalar KulÃ¼bÃ¼',
            'Laboratuvar TeknikerliÄŸi KulÃ¼bÃ¼',
            'Meclis KÃ¼rsÃ¼sÃ¼ KulÃ¼bÃ¼',
            'Medikalde Teknobilim KulÃ¼bÃ¼',
            'SessizliÄŸi Boz KulÃ¼bÃ¼',
            'Metaverse ve GiriÅŸimcilik KulÃ¼bÃ¼',
            'MolekÃ¼ler Biyoloji ve Genetik KulÃ¼bÃ¼',
            'Mucizeye Ä°lk DokunuÅŸ KulÃ¼bÃ¼',
            'Odyoloji KulÃ¼bÃ¼',
            'Ombudsman KulÃ¼bÃ¼',
            'Psikoloji KulÃ¼bÃ¼',
            'PerfÃ¼zyon KulÃ¼bÃ¼',
            'Sosyoloji KulÃ¼bÃ¼',
            'Adli Bilimler Ve Ceza Adaleti KulÃ¼bÃ¼',
            'SaÄŸlÄ±k, KÃ¼ltÃ¼r ve Spor Daire BaÅŸkanlÄ±ÄŸÄ±',
            'STEM Projects KulÃ¼bÃ¼',
            'Stratejik ArÅŸ. ve GeliÅŸtirme KulÃ¼bÃ¼',
            'SÃ¼rdÃ¼rÃ¼lebilir KalkÄ±nma KulÃ¼bÃ¼',
            'Tarih ve KÃ¼ltÃ¼r KulÃ¼bÃ¼',
            'TasarÄ±m KulÃ¼bÃ¼',
            'Teknoloji ve Ä°novasyon KulÃ¼bÃ¼',
            'TÄ±p Ã–ÄŸrencileri BirliÄŸi KulÃ¼bÃ¼',
            'Tiyatro KulÃ¼bÃ¼',
            'TÃ¼rkÃ§e KonuÅŸma KulÃ¼bÃ¼',
            'UluslararasÄ± Diplomasi KulÃ¼bÃ¼',
            'UluslararasÄ± KudÃ¼s GÃ¶nÃ¼llÃ¼leri KulÃ¼bÃ¼',
            'Ãœ.Ãœ. Model BirleÅŸmiÅŸ Milletler KulÃ¼bÃ¼ (MUN)',
            'Ãœretken ReklamcÄ±lar ve GiriÅŸimciler KulÃ¼bÃ¼',
            'ÃœskÃ¼dar Ã‡eviri KulÃ¼bÃ¼',
            'ÃœskÃ¼dar Ãœniversitesi CansaÄŸlÄ±ÄŸÄ± KulÃ¼bÃ¼',
            'ÃœskÃ¼dar Ãœniversitesi GÄ±da KulÃ¼bÃ¼',
            'ÃœskÃ¼dar Ãœniversitesi Nadir HastalÄ±klar KulÃ¼bÃ¼ (ÃœÃœRARE)',
            'ÃœskÃ¼dar Ãœniversitesi NÃ¶robilim KulÃ¼bÃ¼',
            'ÃœskÃ¼dar Ãœniversitesi Tarih KulÃ¼bÃ¼',
            'ÃœskÃ¼dar Ãœniversitesi Teknofest KulÃ¼bÃ¼',
            'Vikipedi Ã–ÄŸrenci KulÃ¼bÃ¼',
            'Yapay Zeka KulÃ¼bÃ¼',
            'Yeni Nesil Ã–ÄŸrenci KulÃ¼bÃ¼',
            'YeÅŸilay KulÃ¼bÃ¼',
            'Animasyon KulÃ¼bÃ¼',
            'DiÅŸ Protez KulÃ¼bÃ¼',
            'EÅŸit AdÄ±mlar KulÃ¼bÃ¼',
            'Avrupa TÄ±p Ã–ÄŸrencileri BirliÄŸi (EMSA)',
            'GeleceÄŸin Liderleri KulÃ¼bÃ¼',
            'GenÃ§ GÃ¶nÃ¼llÃ¼ler KulÃ¼bÃ¼',
            'KÃ¼ltÃ¼rel KeÅŸif KulÃ¼bÃ¼',
            'Ä°lk Acil YardÄ±m KulÃ¼bÃ¼',
            'LÃ¶semili Ã‡ocuklara Fayda KulÃ¼bÃ¼',
            'Milli Miras KulÃ¼bÃ¼',
            'MÃ¼zik KulÃ¼bÃ¼',
            'OkÃ§uluk KulÃ¼bÃ¼',
            'Podoloji KulÃ¼bÃ¼',
            'ÃœskÃ¼dar Ãœniversitesi BiliÅŸim KulÃ¼bÃ¼',
            'ÃœskÃ¼dar Ãœniversitesi ElektronÃ¶rofizyoloji KulÃ¼bÃ¼',
            'ÃœskÃ¼dar Ãœniversitesi Spor KulÃ¼bÃ¼',
            'Yetenek FarkÄ±ndalÄ±ÄŸÄ± KulÃ¼bÃ¼',
            'Felsefe KulÃ¼bÃ¼',
            'Yeni Medya KulÃ¼bÃ¼'
        ];

        // Eski/alternatif isim -> resmÃ® isim
        const CLUB_NAME_ALIASES = {
            'AFAD KulÃ¼bÃ¼': 'Acil Durum Ve Afet YÃ¶netimi KulÃ¼bÃ¼',
            'Acil Durum ve Afet YÃ¶netimi KulÃ¼bÃ¼': 'Acil Durum Ve Afet YÃ¶netimi KulÃ¼bÃ¼',
            'DiyetÃ¼sk KulÃ¼bÃ¼': 'Beslenme Ve Diyetetik KulÃ¼bÃ¼',
            'DiyetÃ¼sk': 'Beslenme Ve Diyetetik KulÃ¼bÃ¼',
            'BÄ°KULÃœP': 'Bikutu ve Rol Yapma OyunlarÄ± KulÃ¼bÃ¼',
            'Bikutu': 'Bikutu ve Rol Yapma OyunlarÄ± KulÃ¼bÃ¼',
            'DKT KulÃ¼bÃ¼': 'Dil ve KonuÅŸma Terapisi KulÃ¼bÃ¼',
            'DiÅŸ HekimliÄŸi Ã–ÄŸrenci BirliÄŸi': 'DiÅŸ HekimliÄŸi Ã–ÄŸrenci BirliÄŸi KulÃ¼bÃ¼',
            'TÄ±p Ã–ÄŸrencileri BirliÄŸi': 'TÄ±p Ã–ÄŸrencileri BirliÄŸi KulÃ¼bÃ¼',
            'IEEE KulÃ¼bÃ¼': 'IEEE ÃœÃœ. Ã–ÄŸr. Kolu KulÃ¼bÃ¼',
            'ÃœÃ‡EV': 'ÃœskÃ¼dar Ã‡eviri KulÃ¼bÃ¼',
            'TÃ¼rk KÄ±zÄ±lay GenÃ§': 'KÄ±zÄ±lay KulÃ¼bÃ¼',
            'GenÃ§ YeÅŸilay KulÃ¼bÃ¼': 'YeÅŸilay KulÃ¼bÃ¼',
            'ÃœskÃ¼dans KulÃ¼bÃ¼': 'Dans KulÃ¼bÃ¼',
            'Tut Elimi KulÃ¼bÃ¼': 'Haydi Tut Elimi KulÃ¼bÃ¼',
            'TeknoFest KulÃ¼bÃ¼': 'ÃœskÃ¼dar Ãœniversitesi Teknofest KulÃ¼bÃ¼',
            'Nadir HastalÄ±klar KulÃ¼bÃ¼': 'ÃœskÃ¼dar Ãœniversitesi Nadir HastalÄ±klar KulÃ¼bÃ¼ (ÃœÃœRARE)',
            'BiliÅŸim KulÃ¼bÃ¼': 'ÃœskÃ¼dar Ãœniversitesi BiliÅŸim KulÃ¼bÃ¼',
            'ElektronÃ¶rofizyoloji KulÃ¼bÃ¼': 'ÃœskÃ¼dar Ãœniversitesi ElektronÃ¶rofizyoloji KulÃ¼bÃ¼',
            'GÄ±da KulÃ¼bÃ¼': 'ÃœskÃ¼dar Ãœniversitesi GÄ±da KulÃ¼bÃ¼',
            'BIOENGTEC': 'BiyomÃ¼hendislik KulÃ¼bÃ¼',
            'ENLK KulÃ¼bÃ¼': 'EndÃ¼stri Ve Liderlik KulÃ¼bÃ¼',
            'ENSA': 'Erasmus Community KulÃ¼bÃ¼ (Erasmus KulÃ¼bÃ¼)',
            'AI and Smart Systems Club': 'Yapay Zeka KulÃ¼bÃ¼',
            'STEM KulÃ¼bÃ¼': 'STEM Projects KulÃ¼bÃ¼',
            'Senaryo BazlÄ± Ä°SG UygulamalarÄ± KulÃ¼bÃ¼': 'Senaryo BazlÄ± Ä°sg UygulamalarÄ± KulÃ¼bÃ¼',
            'Ä°SG KulÃ¼bÃ¼': 'Senaryo BazlÄ± Ä°sg UygulamalarÄ± KulÃ¼bÃ¼',
            'EÅŸit AdÄ±mlar': 'EÅŸit AdÄ±mlar KulÃ¼bÃ¼',
            'Laboratuvar Teknikleri KulÃ¼bÃ¼': 'Laboratuvar TeknikerliÄŸi KulÃ¼bÃ¼',
            'Ä°lk ve Acil YardÄ±m KulÃ¼bÃ¼': 'Ä°lk Acil YardÄ±m KulÃ¼bÃ¼',
            'MUN KulÃ¼bÃ¼': 'Ãœ.Ãœ. Model BirleÅŸmiÅŸ Milletler KulÃ¼bÃ¼ (MUN)',
            'ÃœSKÃœRAT': 'Bilimsel AraÅŸtÄ±rma KulÃ¼bÃ¼ (ÃœSKÃœBAT)'
        };

        function isOfficialClubName(name) {
            return OFFICIAL_CLUB_NAMES.includes(name);
        }

        function canonicalizeClubName(input) {
            const raw = (input || '').toString().trim();
            if (!raw) return null;
            if (isOfficialClubName(raw)) return raw;
            if (CLUB_NAME_ALIASES[raw]) return CLUB_NAME_ALIASES[raw];

            const rawNorm = normalizeKey(raw);
            if (!rawNorm) return null;
            for (const official of OFFICIAL_CLUB_NAMES) {
                if (normalizeKey(official) === rawNorm) return official;
            }
            return null;
        }

        // TasarÄ±m Ã§Ä±ktÄ±sÄ± iÃ§in gÃ¼venli metin + karakter analizi ile otomatik punto/kÄ±saltma
        function escapeHtml(str) {
            return (str ?? '')
                .toString()
                .replace(/&/g, '&amp;')
                .replace(/</g, '&lt;')
                .replace(/>/g, '&gt;')
                .replace(/"/g, '&quot;')
                .replace(/'/g, '&#039;');
        }

        function graphemeLength(str) {
            try {
                // Unicode birleÅŸik karakterler iÃ§in daha doÄŸru sayÄ±m (destek varsa)
                if (typeof Intl !== 'undefined' && Intl.Segmenter) {
                    const seg = new Intl.Segmenter('tr', { granularity: 'grapheme' });
                    let c = 0;
                    for (const _ of seg.segment(str || '')) c++;
                    return c;
                }
            } catch (_) {}
            return Array.from(str || '').length;
        }

        function truncateWithEllipsis(str, maxChars) {
            const s = (str ?? '').toString().trim();
            if (!maxChars || maxChars <= 0) return s;
            if (graphemeLength(s) <= maxChars) return s;
            const arr = Array.from(s);
            const cut = Math.max(0, maxChars - 1);
            return arr.slice(0, cut).join('').trimEnd() + 'â€¦';
        }

        // opts: { baseFont, steps: [{len, font}], maxChars }
        function fitTextForDesign(str, opts) {
            const raw = (str ?? '').toString().trim();
            const len = graphemeLength(raw);
            let fontSize = opts?.baseFont ?? 12;
            const steps = Array.isArray(opts?.steps) ? opts.steps : [];
            for (const step of steps) {
                if (len >= step.len) fontSize = step.font;
            }
            const maxChars = opts?.maxChars ?? 60;
            const clipped = truncateWithEllipsis(raw, maxChars);
            return { text: escapeHtml(clipped), fontSize };
        }

        // KulÃ¼p Listesi (Ã§alÄ±ÅŸan liste)
        let clubNames = [...OFFICIAL_CLUB_NAMES];

        // KulÃ¼p LogolarÄ± VeritabanÄ± - GerÃ§ek dosya isimleriyle eÅŸleÅŸtirildi
        let clubLogoDatabase = {
            'GenÃ§ YeryÃ¼zÃ¼ DoktorlarÄ± KulÃ¼bÃ¼': 'logos/genÃ§ yer yÃ¼zÃ¼ doktorlarÄ±.png',
            'GeleceÄŸin Liderleri KulÃ¼bÃ¼': 'logos/geleceÄŸin liderleri.png',
            'ÃœskÃ¼dar Ãœniversitesi Tarih KulÃ¼bÃ¼': 'logos/tarih kulÃ¼bÃ¼.png',
            'PerfÃ¼zyon KulÃ¼bÃ¼': 'logos/perfÃ¼zyon kulÃ¼bÃ¼.png',
            'Tarih ve KÃ¼ltÃ¼r KulÃ¼bÃ¼': 'logos/tarih ve kÃ¼ltÃ¼r kulÃ¼bÃ¼.png',
            'Intercultural KulÃ¼bÃ¼': 'logos/Ä±ntercultural.png',
            'SessizliÄŸi Boz KulÃ¼bÃ¼': 'logos/sessizkliÄŸi boz kulÃ¼bÃ¼.png',
            'STEM Projects KulÃ¼bÃ¼': 'logos/stem projects.png',
            'Ä°lk ve Acil YardÄ±m KulÃ¼bÃ¼': 'logos/ilk ve acil yardÄ±m.png',
            'YeÅŸilay KulÃ¼bÃ¼': 'logos/genÃ§ yeÅŸilay kulÃ¼bÃ¼.png', // YeÅŸilay iÃ§in genÃ§ yeÅŸilay kullanÄ±ldÄ±
            'Sosyoloji KulÃ¼bÃ¼': 'logos/sosyoloji kulÃ¼bÃ¼.png',
            'ÃœskÃ¼dar Ãœniversitesi CansaÄŸlÄ±ÄŸÄ± KulÃ¼bÃ¼': 'logos/can saÄŸlÄ±ÄŸÄ±.png',
            'ÃœskÃ¼dar Ã‡eviri KulÃ¼bÃ¼': 'logos/Ã§eviri.png',
            'GenÃ§ GÃ¶nÃ¼llÃ¼ler KulÃ¼bÃ¼': 'logos/genÃ§ gÃ¶nÃ¼llÃ¼ler.png',
            'Teknoloji ve Ä°novasyon KulÃ¼bÃ¼': 'logos/teknoloji ve inovasyon kulÃ¼bÃ¼.png',
            'SaÄŸlÄ±k YÃ¶netimi KulÃ¼bÃ¼': 'logos/saÄŸlÄ±k yÃ¶netimi kulÃ¼bÃ¼.png',
            'Senaryo BazlÄ± Ä°SG UygulamalarÄ± KulÃ¼bÃ¼': 'logos/senaryo bazlÄ± isg.png',
            'Fizyoterapi KulÃ¼bÃ¼': 'logos/fizyoterapi kulÃ¼bÃ¼.png',
            'LÃ¶semili Ã‡ocuklara Fayda KulÃ¼bÃ¼': 'logos/lÃ¶semili Ã§ocuklara fayda kulÃ¼bÃ¼.png',
            'Gazetecilik KulÃ¼bÃ¼': 'logos/gazetecilik kulÃ¼bÃ¼.png',
            'Ã‡aÄŸÄ±n VicdanÄ± KulÃ¼bÃ¼': 'logos/Ã§aÄŸÄ±n vicdanÄ±.png',
            'HemÅŸirelik KulÃ¼bÃ¼': 'logos/hemÅŸirelik kulÃ¼bÃ¼.png',
            'Dil ve KonuÅŸma Terapisi KulÃ¼bÃ¼': 'logos/dilvekonuÅŸma.png',
            'SÃ¼rdÃ¼rÃ¼lebilir KalkÄ±nma KulÃ¼bÃ¼': 'logos/sÃ¼rdÃ¼rÃ¼lebilirlik kulÃ¼bÃ¼.png',
            'ÃœskÃ¼dar Ãœniversitesi Spor KulÃ¼bÃ¼': 'logos/spor.png',
            'Adli Bilimler Ve Ceza Adaleti KulÃ¼bÃ¼': 'logos/adlibimler kulÃ¼bÃ¼.png',
            'Ä°yiliÄŸin GeleceÄŸi KulÃ¼bÃ¼': 'logos/iyiliÄŸin geleceÄŸi.png',
            'Ombudsman KulÃ¼bÃ¼': 'logos/ombusman.png',
            'ÃœÃ‡EV': 'logos/Ã§eviri.png', // ÃœÃ‡EV iÃ§in Ã§eviri logosu kullanÄ±ldÄ±
            'Milli Miras KulÃ¼bÃ¼': 'logos/milli miras.png',
            'Yetenek FarkÄ±ndalÄ±ÄŸÄ± KulÃ¼bÃ¼': 'logos/yetenekfarkÄ±ndalÄ±ÄŸÄ±.png',
            'GenÃ§ YeÅŸilay KulÃ¼bÃ¼': 'logos/genÃ§ yeÅŸilay kulÃ¼bÃ¼.png',
            'Kalite KulÃ¼bÃ¼': 'logos/Kalite KulÃ¼bÃ¼ Logo.png',
            'Tiyatro KulÃ¼bÃ¼': 'logos/tiyatro kulÃ¼bÃ¼.png',
            'GenÃ§lik KulÃ¼bÃ¼': 'logos/genÃ§lik kulÃ¼bÃ¼.png',
            'Tut Elimi KulÃ¼bÃ¼': 'logos/haydi tut elimi.png',
            'Animasyon KulÃ¼bÃ¼': 'logos/animasyon.png',
            'TasarÄ±m KulÃ¼bÃ¼': 'logos/tasarÄ±m kulÃ¼bÃ¼.png',
            'ENLK KulÃ¼bÃ¼': 'logos/enlk.png',
            'DiyetÃ¼sk KulÃ¼bÃ¼': 'logos/diyetÃ¼sk.png',
            'Ã‡ocuk GeliÅŸimi KulÃ¼bÃ¼': 'logos/Ã§ocuk geliÅŸimi kulÃ¼bÃ¼.png',
            'Sinema KulÃ¼bÃ¼': 'logos/sinama.png',
            'ÃœskÃ¼dans KulÃ¼bÃ¼': 'logos/dans kulÃ¼bÃ¼.png',
            'MÃ¼zik KulÃ¼bÃ¼': 'logos/mÃ¼zik kulÃ¼bÃ¼.png',
            'EkoVizyon KulÃ¼bÃ¼': 'logos/eko vizyon.png',
            'Yeni Medya KulÃ¼bÃ¼': 'logos/yeni medya kulÃ¼bÃ¼.png',
            'IEEE KulÃ¼bÃ¼': 'logos/Ä±eee.png',
            'TÄ±p Ã–ÄŸrencileri BirliÄŸi': 'logos/tÄ±p Ã¶ÄŸrencileri birliÄŸi.png',
            'TÃ¼rk KÄ±zÄ±lay GenÃ§': 'logos/kÄ±zÄ±lay.png',
            'Proje GeliÅŸtirme ve GenÃ§lik KulÃ¼bÃ¼': 'logos/proje geliÅŸtirme ve genÃ§lik kulÃ¼bÃ¼.png',
            'STEM KulÃ¼bÃ¼': 'logos/stem projects.png', // STEM iÃ§in stem projects kullanÄ±ldÄ±
            'Meclis KÃ¼rsÃ¼sÃ¼ KulÃ¼bÃ¼': 'logos/meclis kulÃ¼bÃ¼.png',
            'ÃœSKÃœRAT': 'logos/bikutu.png', // ÃœSKÃœRAT iÃ§in bikutu kullanÄ±ldÄ±
            'Pozitif Psikoloji KulÃ¼bÃ¼': 'logos/pozitif psikoloji kulÃ¼bÃ¼.png',
            'UluslararasÄ± Diplomasi KulÃ¼bÃ¼': 'logos/uluslararasÄ± diplomasi kulÃ¼bÃ¼.png',
            'GenÃ§ Ä°letiÅŸimciler KulÃ¼bÃ¼': 'logos/genÃ§ iletiÅŸimciler.png',
            'ENSA': 'logos/ensa.png',
            'Felsefe KulÃ¼bÃ¼': 'logos/felsefe kulÃ¼bÃ¼.png',
            'DiÅŸ Protez KulÃ¼bÃ¼': 'logos/diÅŸ protez.png',
            'MolekÃ¼ler Biyoloji ve Genetik KulÃ¼bÃ¼': 'logos/molekÃ¼lerbiyoloji.png',
            'DiÅŸ HekimliÄŸi Ã–ÄŸrenci BirliÄŸi': 'logos/diÅŸ hekimliÄŸi Ã¶ÄŸrencileri birliÄŸi.png',
            'TÃ¼rkÃ§e KonuÅŸma KulÃ¼bÃ¼': 'logos/tÃ¼rkÃ§e konuÅŸma kulÃ¼bÃ¼.png',
            'KÃ¼ltÃ¼rel KeÅŸif KulÃ¼bÃ¼': 'logos/kÃ¼ltÃ¼rel keÅŸlif.png',
            'ElektronÃ¶rofizyoloji KulÃ¼bÃ¼': 'logos/elektronÃ¶rofizyoloji kulÃ¼bÃ¼.png',
            'Fikir ve Aksiyon KulÃ¼bÃ¼': 'logos/fikir ve aksiyon kulÃ¼bÃ¼.png',
            'DKT KulÃ¼bÃ¼': 'logos/dilvekonuÅŸma.png', // DKT iÃ§in dilvekonuÅŸma kullanÄ±ldÄ±
            'BÄ°KULÃœP': 'logos/bikutu.png',
            'Laboratuvar Teknikleri KulÃ¼bÃ¼': 'logos/laboratuar teknikerliÄŸi kulÃ¼bÃ¼.png',
            'TeknoFest KulÃ¼bÃ¼': 'logos/teknofest kulÃ¼bÃ¼.png',
            'Ergoterapi KulÃ¼bÃ¼': 'logos/ergoterapi.png',
            'EÅŸit AdÄ±mlar': 'logos/eÅŸit adÄ±mlar.png',
            'Odyoloji KulÃ¼bÃ¼': 'logos/odyoloji kulÃ¼bÃ¼.png',
            'GÄ±da KulÃ¼bÃ¼': 'logos/gÄ±da kulÃ¼bÃ¼.png',
            'BiliÅŸim KulÃ¼bÃ¼': 'logos/biliÅŸim.png',
            'Podoloji KulÃ¼bÃ¼': 'logos/podyoloji.png',
            'GenÃ§ TÄ±bbiyeliler KulÃ¼bÃ¼': 'logos/genÃ§ tÄ±bbiyeliler kulÃ¼bÃ¼.png',
            'BIOENGTEC': 'logos/bioengtec.png',
            'OkÃ§uluk KulÃ¼bÃ¼': 'logos/okÃ§uluk.png',
            'Anestezi KulÃ¼bÃ¼': 'logos/Anestezi kulÃ¼bÃ¼_.png',
            'Sosyal Hizmet KulÃ¼bÃ¼': 'logos/sosyal hizmetler.png',
            'AFAD KulÃ¼bÃ¼': 'logos/afad kulÃ¼bÃ¼.png',
            'MUN KulÃ¼bÃ¼': 'logos/mun kulÃ¼bÃ¼.png',
            'AI and Smart Systems Club': 'logos/artÄ±fÄ±cÄ±al Ä±ntellÄ±gence and smart systems club.png',
            'Mucizeye Ä°lk DokunuÅŸ KulÃ¼bÃ¼': 'logos/mucizeye ilk dokunuÅŸ.png',
            'Finansal OkuryazarlÄ±k KulÃ¼bÃ¼': 'logos/finansalokuryazarlÄ±k.png',
            'Ä°SG KulÃ¼bÃ¼': 'logos/isg kulÃ¼bÃ¼.png',
            'Nadir HastalÄ±klar KulÃ¼bÃ¼': 'logos/nadir hastalÄ±klar kulÃ¼bÃ¼.png',
            'Fizyoterapi ve Rehabilitasyon KulÃ¼bÃ¼': 'logos/fizyoterapi ve rehebilitasyon kulÃ¼bÃ¼.png',
            'ÃœskÃ¼dar Ãœniversitesi': 'logos/spor.png' // Ãœniversite iÃ§in spor logosu kullanÄ±ldÄ±
        };
        
        // Base64 Logo VeritabanÄ± (GitHub Pages iÃ§in)
        let clubLogoBase64Database = {};

        // BaÅŸlangÄ±Ã§ veritabanlarÄ±nÄ± resmÃ® isimlere taÅŸÄ± (alias/normalizasyon).
        function migrateLogoDatabasesToOfficial() {
            try {
                const currentMap = clubLogoDatabase || {};
                const currentB64 = clubLogoBase64Database || {};
                const resultMap = {};
                const resultB64 = {};

                // ResmÃ® listede olanlarÄ± Ã¶nceliklendir
                OFFICIAL_CLUB_NAMES.forEach((official) => {
                    if (currentMap[official]) resultMap[official] = currentMap[official];
                    if (currentB64[official]) resultB64[official] = currentB64[official];
                });

                // Eski/alternatif anahtarlarÄ± resmÃ® anahtara taÅŸÄ±
                Object.keys(currentMap).forEach((k) => {
                    const canon = canonicalizeClubName(k);
                    if (!canon) return;
                    if (!resultMap[canon] && currentMap[k]) resultMap[canon] = currentMap[k];
                });
                Object.keys(currentB64).forEach((k) => {
                    const canon = canonicalizeClubName(k);
                    if (!canon) return;
                    if (!resultB64[canon] && currentB64[k]) resultB64[canon] = currentB64[k];
                });

                clubLogoDatabase = resultMap;
                clubLogoBase64Database = resultB64;
            } catch (e) {
                console.warn('Logo veritabanÄ± migration hatasÄ±:', e);
            }
        }

        // Sayfa aÃ§Ä±lÄ±ÅŸÄ±nda bir kez uygula (hardcoded mapping'ler iÃ§in)
        migrateLogoDatabasesToOfficial();

        let events = {};
        // GÃ¼n bazlÄ± tarih hafÄ±zasÄ± (ISO: YYYY-MM-DD). GÃ¼n deÄŸiÅŸtirip geri gelince tarihi otomatik geri doldurur.
        const dayDateISO = {};
        let draggedElement = null;

        // Etkinlik verisini yenilemede kaybetmemek iÃ§in localStorage'a otomatik kaydet/geri yÃ¼kle
        // Her hafta ayrÄ± kayÄ±t: localStorage keyâ€™i hafta anahtarÄ±na gÃ¶re tÃ¼retilir.
        const EVENTS_STORAGE_KEY_PREFIX = 'sks_events_state_v1_';
        const EVENTS_LAST_WEEK_KEY = 'sks_events_last_week_key';
        let _eventsSaveTimer = null;
        let _cloudSaveTimer = null;

        const CLOUD_CFG_KEYS = {
            url: 'sks_supabase_url',
            anon: 'sks_supabase_anon',
            auto: 'sks_supabase_auto_sync'
        };
        const CLOUD_SESSION_KEY = 'sks_supabase_session_v1';

        function setCloudStatus(text) {
            const el = document.getElementById('cloudSyncStatus');
            if (el) el.textContent = text || '';
        }

        function getSupabaseConfig() {
            const url = (localStorage.getItem(CLOUD_CFG_KEYS.url) || '').trim();
            const anonKey = (localStorage.getItem(CLOUD_CFG_KEYS.anon) || '').trim();
            const auto = (localStorage.getItem(CLOUD_CFG_KEYS.auto) || 'false') === 'true';
            return { url, anonKey, auto };
        }

        function getSupabaseSession() {
            try {
                const raw = localStorage.getItem(CLOUD_SESSION_KEY);
                if (!raw) return null;
                const s = JSON.parse(raw);
                if (!s || typeof s !== 'object') return null;
                return s;
            } catch (_) {
                return null;
            }
        }

        function setSupabaseSession(session) {
            if (!session) {
                localStorage.removeItem(CLOUD_SESSION_KEY);
                return;
            }
            localStorage.setItem(CLOUD_SESSION_KEY, JSON.stringify(session));
        }

        function updateCloudAuthStatusUI() {
            const s = getSupabaseSession();
            const status = s?.email ? `ğŸ‘¤ GiriÅŸ: ${s.email}` : 'ğŸ‘¤ GiriÅŸ yapÄ±lmadÄ±';
            const el = document.getElementById('cloudAuthStatus');
            if (el) el.textContent = status;
        }

        async function supabaseAuthLogin() {
            const cfg = getSupabaseConfig();
            if (!cfg.url || !cfg.anonKey) {
                alert('âŒ Ã–nce Supabase URL ve Anon Key girip kaydedin.');
                return;
            }
            const email = (document.getElementById('supabaseEmail')?.value || '').trim();
            const password = (document.getElementById('supabasePassword')?.value || '').trim();
            if (!email || !password) {
                alert('âŒ Email ve ÅŸifre gerekli.');
                return;
            }
            try {
                setCloudStatus('ğŸ” GiriÅŸ yapÄ±lÄ±yor...');
                const url = cfg.url.replace(/\/+$/, '') + '/auth/v1/token?grant_type=password';
                const res = await fetch(url, {
                    method: 'POST',
                    headers: {
                        apikey: cfg.anonKey,
                        Authorization: `Bearer ${cfg.anonKey}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ email, password })
                });
                const data = await res.json().catch(() => null);
                if (!res.ok) {
                    throw new Error(data?.error_description || data?.msg || data?.message || 'GiriÅŸ baÅŸarÄ±sÄ±z');
                }
                const now = Math.floor(Date.now() / 1000);
                setSupabaseSession({
                    access_token: data.access_token,
                    refresh_token: data.refresh_token,
                    expires_at: now + (data.expires_in || 3600),
                    email: data.user?.email || email,
                    user_id: data.user?.id || null
                });
                updateCloudAuthStatusUI();
                setCloudStatus('âœ… GiriÅŸ baÅŸarÄ±lÄ±.');
            } catch (e) {
                console.error(e);
                setCloudStatus('âŒ GiriÅŸ baÅŸarÄ±sÄ±z.');
                alert('âŒ Supabase giriÅŸ hatasÄ±: ' + (e?.message || e));
            }
        }

        async function supabaseAuthRefreshIfNeeded() {
            const cfg = getSupabaseConfig();
            const s = getSupabaseSession();
            if (!cfg.url || !cfg.anonKey || !s?.refresh_token) return null;
            const now = Math.floor(Date.now() / 1000);
            if (s.expires_at && s.expires_at - now > 60 && s.access_token) return s.access_token;
            try {
                const url = cfg.url.replace(/\/+$/, '') + '/auth/v1/token?grant_type=refresh_token';
                const res = await fetch(url, {
                    method: 'POST',
                    headers: {
                        apikey: cfg.anonKey,
                        Authorization: `Bearer ${cfg.anonKey}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ refresh_token: s.refresh_token })
                });
                const data = await res.json().catch(() => null);
                if (!res.ok) throw new Error(data?.error_description || 'Token yenilenemedi');
                const now2 = Math.floor(Date.now() / 1000);
                setSupabaseSession({
                    access_token: data.access_token,
                    refresh_token: data.refresh_token || s.refresh_token,
                    expires_at: now2 + (data.expires_in || 3600),
                    email: data.user?.email || s.email || '',
                    user_id: data.user?.id || s.user_id || null
                });
                updateCloudAuthStatusUI();
                return data.access_token;
            } catch (e) {
                console.warn('Token refresh hatasÄ±:', e);
                return null;
            }
        }

        async function supabaseAuthLogout() {
            setSupabaseSession(null);
            updateCloudAuthStatusUI();
            setCloudStatus('ğŸ‘‹ Ã‡Ä±kÄ±ÅŸ yapÄ±ldÄ±.');
        }

        function saveSupabaseConfig() {
            const url = (document.getElementById('supabaseUrl')?.value || '').trim();
            const anonKey = (document.getElementById('supabaseAnonKey')?.value || '').trim();
            if (!url || !anonKey) {
                alert('âŒ Supabase URL ve Anon Key gerekli.');
                return;
            }
            localStorage.setItem(CLOUD_CFG_KEYS.url, url);
            localStorage.setItem(CLOUD_CFG_KEYS.anon, anonKey);
            setCloudStatus('âœ… Ayarlar kaydedildi.');
        }

        function toggleCloudAutoSync() {
            const checked = !!document.getElementById('cloudAutoSync')?.checked;
            localStorage.setItem(CLOUD_CFG_KEYS.auto, checked ? 'true' : 'false');
            setCloudStatus(checked ? 'ğŸ” Otomatik senkron aÃ§Ä±k' : 'â¸ï¸ Otomatik senkron kapalÄ±');
        }

        // "Mevcut hafta" state'i: hafta deÄŸiÅŸiminde eski haftayÄ± doÄŸru anahtarla kaydetmek iÃ§in.
        let currentWeekState = { startDate: '', endDate: '' };
        let currentWeekKey = 'week_default';

        function computeWeekKey(weekState) {
            const w = weekState || {};
            const base = `${w.startDate || ''}_${w.endDate || ''}`.trim();
            const key = normalizeKey(base) || 'default';
            return `week_${key}`;
        }

        function getWeekKeyForCloud(weekState = currentWeekState) {
            return computeWeekKey(weekState);
        }

        function getWeekKeyForLocal(weekState = currentWeekState) {
            return computeWeekKey(weekState);
        }

        function getLocalEventsStorageKeyForWeekKey(weekKey) {
            return EVENTS_STORAGE_KEY_PREFIX + (weekKey || 'week_default');
        }

        function getLocalEventsStorageKey() {
            return getLocalEventsStorageKeyForWeekKey(currentWeekKey);
        }

        async function supabaseRequest(path, { method = 'GET', headers = {}, body } = {}) {
            const cfg = getSupabaseConfig();
            if (!cfg.url || !cfg.anonKey) throw new Error('Supabase ayarlarÄ± eksik.');
            const needsAuth = method && method.toUpperCase() !== 'GET';
            const token = await supabaseAuthRefreshIfNeeded();
            if (needsAuth && !token) {
                throw new Error('Buluta yazmak iÃ§in Supabase ile giriÅŸ yapÄ±n (email/ÅŸifre).');
            }
            const url = cfg.url.replace(/\/+$/, '') + path;
            const res = await fetch(url, {
                method,
                headers: {
                    apikey: cfg.anonKey,
                    Authorization: `Bearer ${token || cfg.anonKey}`,
                    'Content-Type': 'application/json',
                    ...headers
                },
                body: body ? JSON.stringify(body) : undefined
            });
            const text = await res.text();
            let data = null;
            try { data = text ? JSON.parse(text) : null; } catch (_) { data = text; }
            if (!res.ok) {
                const msg = typeof data === 'string' ? data : (data?.message || data?.error_description || JSON.stringify(data));
                throw new Error(`Supabase hata: ${res.status} ${msg}`);
            }
            return data;
        }

        // Tablo: public.events_state (week_key text primary key, payload jsonb, updated_at timestamptz default now())
        async function cloudPushEvents() {
            try {
                setCloudStatus('â¬†ï¸ Buluta gÃ¶nderiliyor...');
                const week_key = getWeekKeyForCloud();
                const payload = {
                    version: 1,
                    savedAt: new Date().toISOString(),
                    week: { ...currentWeekState },
                    dayDateISO: { ...dayDateISO },
                    events: serializeEventsForStorage(events)
                };
                // RLS aÃ§Ä±kken yazmak iÃ§in owner_id gerekir (auth.uid() ile eÅŸleÅŸecek).
                const owner_id = getSupabaseSession()?.user_id || null;
                const body = [{ week_key, payload, owner_id }];
                await supabaseRequest(`/rest/v1/events_state`, {
                    method: 'POST',
                    headers: { Prefer: 'resolution=merge-duplicates,return=minimal' },
                    body
                });
                setCloudStatus('âœ… Buluta kaydedildi.');
            } catch (e) {
                console.error(e);
                setCloudStatus('âŒ Buluta gÃ¶nderilemedi.');
                alert('âŒ Buluta gÃ¶nderme hatasÄ±: ' + (e?.message || e));
            }
        }

        async function cloudPullEvents() {
            try {
                setCloudStatus('â¬‡ï¸ Buluttan Ã§ekiliyor...');
                const week_key = getWeekKeyForCloud();
                const data = await supabaseRequest(`/rest/v1/events_state?week_key=eq.${encodeURIComponent(week_key)}&select=payload`, {
                    method: 'GET'
                });
                const row = Array.isArray(data) ? data[0] : null;
                if (!row?.payload) {
                    setCloudStatus('â„¹ï¸ Bulutta veri bulunamadÄ±.');
                    alert('â„¹ï¸ Bulutta bu hafta iÃ§in kayÄ±t bulunamadÄ±.');
                    return;
                }

                // Yerel veri varsa sor
                const hasLocal = Object.keys(events || {}).some((k) => (events[k]?.events || []).length > 0);
                if (hasLocal) {
                    const ok = confirm('Bulutta kayÄ±t bulundu. Mevcut yerel etkinliklerin Ã¼zerine yazÄ±lsÄ±n mÄ±?');
                    if (!ok) {
                        setCloudStatus('â¸ï¸ Ä°ptal edildi.');
                        return;
                    }
                }

                const payload = row.payload;
                if (payload.week) setWeekStateToInputs(payload.week);
                // HaftayÄ± "mevcut hafta" olarak set et
                currentWeekState = payload.week || getWeekStateFromInputs();
                currentWeekKey = computeWeekKey(currentWeekState);
                if (payload.dayDateISO && typeof payload.dayDateISO === 'object') {
                    Object.keys(payload.dayDateISO).forEach((k) => { dayDateISO[k] = payload.dayDateISO[k]; });
                }
                if (payload.events && typeof payload.events === 'object') {
                    events = payload.events;
                } else {
                    events = {};
                }
                hydrateEventsAfterLoad();
                refreshEventLogosFromDatabase();
                renderEvents();
                saveEventsStateNow();
                setCloudStatus('âœ… Buluttan yÃ¼klendi.');
            } catch (e) {
                console.error(e);
                setCloudStatus('âŒ Buluttan Ã§ekilemedi.');
                alert('âŒ Buluttan Ã§ekme hatasÄ±: ' + (e?.message || e));
            }
        }

        async function cloudFetchPayload(week_key) {
            const data = await supabaseRequest(`/rest/v1/events_state?week_key=eq.${encodeURIComponent(week_key)}&select=payload`, { method: 'GET' });
            const row = Array.isArray(data) ? data[0] : null;
            return row?.payload || null;
        }

        function localHasEvents() {
            return Object.keys(events || {}).some((k) => (events[k]?.events || []).length > 0);
        }

        function parseISO(iso) {
            const t = Date.parse(iso || '');
            return Number.isFinite(t) ? t : 0;
        }

        // Otomatik senkron: aynÄ± hafta iÃ§in hangisi daha yeniyse onu seÃ§ (pull veya push)
        async function cloudAutoSyncResolveForWeek() {
            const cfg = getSupabaseConfig();
            if (!cfg.auto) return;
            const week_key = getWeekKeyForCloud();
            try {
                setCloudStatus('ğŸ” Bulut senkron kontrol ediliyor...');
                const cloud = await cloudFetchPayload(week_key).catch(() => null);
                const localKey = getLocalEventsStorageKey();
                const localRaw = localStorage.getItem(localKey);
                const localParsed = localRaw ? JSON.parse(localRaw) : null;

                const cloudSaved = parseISO(cloud?.savedAt);
                const localSaved = parseISO(localParsed?.savedAt);

                // Bulutta yoksa: lokalde veri varsa push
                if (!cloud) {
                    if (localHasEvents()) {
                        await cloudPushEvents();
                    } else {
                        setCloudStatus('â„¹ï¸ Bulutta veri yok (boÅŸ hafta).');
                    }
                    return;
                }

                // Lokalde yoksa: pull
                if (!localParsed || !localHasEvents()) {
                    // sessiz pull (prompt yok)
                    if (cloud.week) setWeekStateToInputs(cloud.week);
                    if (cloud.dayDateISO && typeof cloud.dayDateISO === 'object') {
                        Object.keys(cloud.dayDateISO).forEach((k) => { dayDateISO[k] = cloud.dayDateISO[k]; });
                    }
                    events = cloud.events || {};
                    hydrateEventsAfterLoad();
                    refreshEventLogosFromDatabase();
                    renderEvents();
                    saveEventsStateNow();
                    setCloudStatus('âœ… Buluttan otomatik yÃ¼klendi.');
                    return;
                }

                // Ä°kisi de varsa: daha yeni olan kazanÄ±r
                if (cloudSaved > localSaved) {
                    events = cloud.events || {};
                    if (cloud.week) setWeekStateToInputs(cloud.week);
                    if (cloud.dayDateISO && typeof cloud.dayDateISO === 'object') {
                        Object.keys(cloud.dayDateISO).forEach((k) => { dayDateISO[k] = cloud.dayDateISO[k]; });
                    }
                    hydrateEventsAfterLoad();
                    refreshEventLogosFromDatabase();
                    renderEvents();
                    saveEventsStateNow();
                    setCloudStatus('âœ… Bulut daha yeni: otomatik Ã§ekildi.');
                } else if (localSaved > cloudSaved) {
                    await cloudPushEvents();
                    setCloudStatus('âœ… Lokal daha yeni: otomatik gÃ¶nderildi.');
                } else {
                    setCloudStatus('âœ… Bulut/Lokal zaten aynÄ± (tarih eÅŸit).');
                }
            } catch (e) {
                console.warn('Auto sync hatasÄ±:', e);
                setCloudStatus('âš ï¸ Otomatik senkron baÅŸarÄ±sÄ±z.');
            }
        }

        function scheduleCloudPush() {
            const cfg = getSupabaseConfig();
            if (!cfg.auto) return;
            clearTimeout(_cloudSaveTimer);
            _cloudSaveTimer = setTimeout(() => {
                cloudPushEvents();
            }, 800);
        }

        function getWeekStateFromInputs() {
            const startDate = (document.getElementById('startDate')?.value || '').trim();
            const endDate = (document.getElementById('endDate')?.value || '').trim();
            return { startDate, endDate };
        }

        function setWeekStateToInputs(state) {
            try {
                if (state?.startDate) document.getElementById('startDate').value = state.startDate;
                if (state?.endDate) document.getElementById('endDate').value = state.endDate;
            } catch (_) {}
        }

        function serializeEventsForStorage(src) {
            const out = {};
            Object.keys(src || {}).forEach((day) => {
                const d = src[day];
                if (!d || !Array.isArray(d.events)) return;
                out[day] = {
                    dayName: d.dayName || day,
                    date: d.date || '',
                    isoDate: d.isoDate || '',
                    events: d.events.map((ev) => {
                        const clubName = canonicalizeClubName(ev?.clubName) || (ev?.clubName || '');
                        let clubIcon = ev?.clubIcon || '';
                        // base64 ÅŸiÅŸirmesin: tekrar Ã¼retiriz
                        if (typeof clubIcon === 'string' && clubIcon.startsWith('data:')) clubIcon = '';
                        return {
                            clubName,
                            clubIcon,
                            eventTitle: ev?.eventTitle || '',
                            time: ev?.time || '',
                            location: ev?.location || '',
                            campus: ev?.campus || '',
                            isOnline: !!ev?.isOnline
                        };
                    })
                };
            });
            return out;
        }

        function hydrateEventsAfterLoad() {
            try {
                Object.keys(events || {}).forEach((day) => {
                    const d = events[day];
                    if (!d || !Array.isArray(d.events)) return;
                    // isoDate varsa gÃ¼n bazlÄ± hafÄ±zaya da yaz
                    if (d.isoDate) dayDateISO[day] = d.isoDate;
                    d.events.forEach((ev) => {
                        if (!ev) return;
                        const canon = canonicalizeClubName(ev.clubName) || ev.clubName;
                        if (canon) ev.clubName = canon;
                        if (!ev.clubIcon) {
                            const src = getLogoSource(ev.clubName);
                            if (src) ev.clubIcon = src;
                        }
                    });
                });
            } catch (_) {}
        }

        function saveEventsStateNow(options = {}) {
            try {
                const weekKey = options.weekKey || currentWeekKey;
                const weekState = options.weekState || currentWeekState;
                const skipCloud = options.skipCloud === true;
                const payload = {
                    version: 1,
                    savedAt: new Date().toISOString(),
                    week: { ...weekState },
                    dayDateISO: { ...dayDateISO },
                    events: serializeEventsForStorage(events)
                };
                localStorage.setItem(getLocalEventsStorageKeyForWeekKey(weekKey), JSON.stringify(payload));
                localStorage.setItem(EVENTS_LAST_WEEK_KEY, weekKey);
                if (!skipCloud) scheduleCloudPush();
            } catch (e) {
                console.warn('Etkinlikler kaydedilemedi:', e);
            }
        }

        function scheduleSaveEventsState() {
            clearTimeout(_eventsSaveTimer);
            _eventsSaveTimer = setTimeout(saveEventsStateNow, 300);
        }

        function loadEventsStateFromStorage(weekKey = currentWeekKey) {
            try {
                // Ã–nce bu hafta key'i ile yÃ¼kle
                let raw = localStorage.getItem(getLocalEventsStorageKeyForWeekKey(weekKey));
                // Eski tekil keyâ€™den migration (varsa)
                if (!raw) {
                    const legacy = localStorage.getItem('sks_events_state_v1');
                    if (legacy) {
                        raw = legacy;
                        // Bu haftaya kopyala (ilk geÃ§iÅŸ)
                        localStorage.setItem(getLocalEventsStorageKeyForWeekKey(weekKey), legacy);
                    }
                }
                if (!raw) return false;
                const parsed = JSON.parse(raw);
                if (!parsed || typeof parsed !== 'object') return false;
                if (parsed.week) setWeekStateToInputs(parsed.week);
                currentWeekState = parsed.week || getWeekStateFromInputs();
                currentWeekKey = computeWeekKey(currentWeekState);
                if (parsed.dayDateISO && typeof parsed.dayDateISO === 'object') {
                    Object.keys(parsed.dayDateISO).forEach((k) => {
                        dayDateISO[k] = parsed.dayDateISO[k];
                    });
                }
                if (parsed.events && typeof parsed.events === 'object') {
                    events = parsed.events;
                }
                hydrateEventsAfterLoad();
                return true;
            } catch (e) {
                console.warn('Etkinlikler yÃ¼klenemedi:', e);
                return false;
            }
        }

        function setupEventsAutoSave() {
            const startEl = document.getElementById('startDate');
            const endEl = document.getElementById('endDate');
            [startEl, endEl].forEach((el) => {
                if (!el) return;
                el.addEventListener('input', () => onWeekInputsChanged());
                el.addEventListener('change', () => onWeekInputsChanged());
            });
        }

        function resetWeekStateInMemory() {
            // Bu haftaya geÃ§erken Ã¶nce form state'i temizle
            Object.keys(dayDateISO).forEach((k) => { delete dayDateISO[k]; });
            events = {};
        }

        function loadLocalWeekOrEmpty() {
            // Bu hafta iÃ§in local kayÄ±t varsa yÃ¼kle, yoksa boÅŸalt
            const ok = loadEventsStateFromStorage();
            if (!ok) {
                resetWeekStateInMemory();
            }
            hydrateEventsAfterLoad();
            refreshEventLogosFromDatabase();
            try { renderEvents(); } catch (_) {}
        }

        function onWeekInputsChanged() {
            // Ã–nce mevcut haftayÄ± (old key) lokalâ€™e kaydet, sonra yeni haftaya geÃ§
            const prevKey = currentWeekKey;
            const prevState = { ...currentWeekState };
            try { saveEventsStateNow({ weekKey: prevKey, weekState: prevState, skipCloud: true }); } catch (_) {}

            // Yeni haftayÄ± belirle
            currentWeekState = getWeekStateFromInputs();
            currentWeekKey = computeWeekKey(currentWeekState);

            // Yeni hafta datasÄ±nÄ± yÃ¼kle
            loadLocalWeekOrEmpty();

            // Auto sync aÃ§Ä±ksa yeni hafta iÃ§in bulutla Ã§Ã¶z
            cloudAutoSyncResolveForWeek();
        }

        // PaylaÅŸÄ±mlÄ± kullanÄ±m iÃ§in: repoya konan events-data.json'dan etkinlikleri yÃ¼kle (varsa)
        async function loadEventsFromJSON() {
            try {
                const res = await fetch('events-data.json', { cache: 'no-store' });
                if (!res.ok) return false;
                const data = await res.json();
                if (!data || typeof data !== 'object') return false;

                // Beklenen format:
                // { version, exportDate, week: {startDate,endDate}, events: { [day]: {date, isoDate, events: [...] } } }
                if (data.week) setWeekStateToInputs(data.week);
                if (data.dayDateISO && typeof data.dayDateISO === 'object') {
                    Object.keys(data.dayDateISO).forEach((k) => {
                        dayDateISO[k] = data.dayDateISO[k];
                    });
                }
                if (data.events && typeof data.events === 'object') {
                    events = data.events;
                    hydrateEventsAfterLoad();
                    return true;
                }
                return false;
            } catch (_) {
                // Dosya yoksa normal
                return false;
            }
        }

        function exportEventsToJSON() {
            try {
                const payload = {
                    version: 1,
                    exportDate: new Date().toISOString(),
                    week: getWeekStateFromInputs(),
                    dayDateISO: { ...dayDateISO },
                    events: serializeEventsForStorage(events)
                };
                const jsonString = JSON.stringify(payload, null, 2);
                const blob = new Blob([jsonString], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'events-data.json';
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                alert('âœ… events-data.json indirildi!\n\nÄ°pucu: GitHub Pages iÃ§in bu dosyayÄ± repo kÃ¶k dizinine koyup push edebilirsiniz.');
            } catch (e) {
                alert('âŒ JSON dÄ±ÅŸa aktarma hatasÄ±: ' + (e?.message || e));
            }
        }

        async function importEventsFromJSONFile(e) {
            try {
                const file = e?.target?.files?.[0];
                if (!file) return;
                const text = await file.text();
                const data = JSON.parse(text);
                if (!data || typeof data !== 'object' || !data.events || typeof data.events !== 'object') {
                    alert('âŒ GeÃ§ersiz JSON formatÄ±.');
                    return;
                }

                // Var olanlarÄ± deÄŸiÅŸtir (import = restore)
                events = data.events;
                if (data.week) setWeekStateToInputs(data.week);
                if (data.dayDateISO && typeof data.dayDateISO === 'object') {
                    Object.keys(data.dayDateISO).forEach((k) => {
                        dayDateISO[k] = data.dayDateISO[k];
                    });
                }

                hydrateEventsAfterLoad();
                refreshEventLogosFromDatabase();
                renderEvents();
                saveEventsStateNow();
                alert('âœ… Etkinlikler JSONâ€™dan yÃ¼klendi!');
            } catch (err) {
                alert('âŒ JSON iÃ§e aktarma hatasÄ±: ' + (err?.message || err));
            } finally {
                // AynÄ± dosyayÄ± tekrar seÃ§ebilmek iÃ§in temizle
                try { e.target.value = ''; } catch (_) {}
            }
        }

        // Debug loglarÄ± (production'da kapalÄ±)
        const DEBUG = false;
        function dlog(...args) { if (DEBUG) console.log(...args); }
        function dwarn(...args) { if (DEBUG) console.warn(...args); }

        // BÃ¼yÃ¼k logo setleri iÃ§in LocalStorage limiti aÅŸÄ±labiliyor.
        // Bu yÃ¼zden base64 logolarÄ± IndexedDB'de saklÄ±yoruz (file:// altÄ±nda indirme iÃ§in en stabil yol).
        const LOGO_IDB = {
            name: 'tasarimLogoDB',
            version: 1,
            stores: {
                logos: 'logos',     // key: clubName, value: base64
                meta: 'meta'        // key: string, value: any
            }
        };

        function openLogoDB() {
            return new Promise((resolve, reject) => {
                if (!('indexedDB' in window)) {
                    reject(new Error('IndexedDB desteklenmiyor'));
                    return;
                }
                const req = indexedDB.open(LOGO_IDB.name, LOGO_IDB.version);
                req.onupgradeneeded = () => {
                    const db = req.result;
                    if (!db.objectStoreNames.contains(LOGO_IDB.stores.logos)) {
                        db.createObjectStore(LOGO_IDB.stores.logos);
                    }
                    if (!db.objectStoreNames.contains(LOGO_IDB.stores.meta)) {
                        db.createObjectStore(LOGO_IDB.stores.meta);
                    }
                };
                req.onsuccess = () => resolve(req.result);
                req.onerror = () => reject(req.error || new Error('IndexedDB aÃ§Ä±lamadÄ±'));
            });
        }

        async function idbSet(storeName, key, value) {
            const db = await openLogoDB();
            return new Promise((resolve, reject) => {
                const tx = db.transaction(storeName, 'readwrite');
                const store = tx.objectStore(storeName);
                store.put(value, key);
                tx.oncomplete = () => resolve();
                tx.onerror = () => reject(tx.error || new Error('IndexedDB yazma hatasÄ±'));
            });
        }

        async function idbGet(storeName, key) {
            const db = await openLogoDB();
            return new Promise((resolve, reject) => {
                const tx = db.transaction(storeName, 'readonly');
                const store = tx.objectStore(storeName);
                const req = store.get(key);
                req.onsuccess = () => resolve(req.result);
                req.onerror = () => reject(req.error || new Error('IndexedDB okuma hatasÄ±'));
            });
        }

        async function idbGetAll(storeName) {
            const db = await openLogoDB();
            return new Promise((resolve, reject) => {
                const tx = db.transaction(storeName, 'readonly');
                const store = tx.objectStore(storeName);
                const req = store.getAllKeys();
                const out = {};
                req.onsuccess = async () => {
                    const keys = req.result || [];
                    if (!keys.length) { resolve(out); return; }
                    let pending = keys.length;
                    keys.forEach((k) => {
                        const r = store.get(k);
                        r.onsuccess = () => {
                            out[k] = r.result;
                            pending--;
                            if (pending === 0) resolve(out);
                        };
                        r.onerror = () => {
                            pending--;
                            if (pending === 0) resolve(out);
                        };
                    });
                };
                req.onerror = () => reject(req.error || new Error('IndexedDB keys okunamadÄ±'));
            });
        }

        async function persistBase64LogosToIDB() {
            // KulÃ¼p logolarÄ±
            const entries = Object.entries(clubLogoBase64Database || {}).filter(([, v]) => typeof v === 'string' && v.startsWith('data:'));
            for (const [club, b64] of entries) {
                await idbSet(LOGO_IDB.stores.logos, club, b64);
            }
            // Header logolarÄ±
            const uu = localStorage.getItem('headerUULogoBase64');
            const sks = localStorage.getItem('headerSKSLogoBase64');
            if (uu && uu.startsWith('data:')) await idbSet(LOGO_IDB.stores.meta, 'headerUULogoBase64', uu);
            if (sks && sks.startsWith('data:')) await idbSet(LOGO_IDB.stores.meta, 'headerSKSLogoBase64', sks);
        }

        async function loadBase64LogosFromIDB() {
            try {
                const all = await idbGetAll(LOGO_IDB.stores.logos);
                Object.keys(all || {}).forEach((club) => {
                    const v = all[club];
                    if (typeof v === 'string' && v.startsWith('data:')) {
                        clubLogoBase64Database[club] = v;
                    }
                });
                const uu = await idbGet(LOGO_IDB.stores.meta, 'headerUULogoBase64').catch(() => null);
                const sks = await idbGet(LOGO_IDB.stores.meta, 'headerSKSLogoBase64').catch(() => null);
                if (uu && typeof uu === 'string' && uu.startsWith('data:')) localStorage.setItem('headerUULogoBase64', uu);
                if (sks && typeof sks === 'string' && sks.startsWith('data:')) localStorage.setItem('headerSKSLogoBase64', sks);
            } catch (e) {
                dwarn('IndexedDB logo yÃ¼kleme hatasÄ±:', e);
            }
        }

        function addEvent() {
            console.log('addEvent Ã§aÄŸrÄ±ldÄ±');
            
            const day = document.getElementById('daySelect').value;
            const dateInputEl = document.getElementById('fullDate');
            const fullDate = document.getElementById('fullDateFormatted').value || document.getElementById('fullDate').value;
            const clubNameRaw = document.getElementById('clubName').value.trim();
            const clubName = canonicalizeClubName(clubNameRaw);
            
            console.log('Form deÄŸerleri:', { day, fullDate, clubNameRaw, clubName });
            
            let clubIcon = 'ğŸ¯';
            if (clubName) {
                const logoSrc = getLogoSource(clubName);
                console.log('Logo kaynaÄŸÄ±:', logoSrc ? (logoSrc.substring(0, 30) + '...') : 'bulunamadÄ±', 'kulÃ¼p:', clubName);
                if (logoSrc) {
                    clubIcon = logoSrc;
                } else {
                    console.log('Logo bulunamadÄ±:', clubName);
                    console.log('clubLogoDatabase kontrol:', clubLogoDatabase[clubName]);
                    console.log('clubLogoBase64Database kontrol:', clubLogoBase64Database[clubName]);
                }
            }
            
            const eventTitle = document.getElementById('eventTitle').value.trim();
            const eventTime = document.getElementById('eventTime').value;
            const campus = document.getElementById('campusSelect').value;
            const eventLocation = document.getElementById('eventLocation').value.trim();
            const isOnline = document.getElementById('isOnline').checked;

            // Validasyon mesajlarÄ±
            if (!day) {
                alert('âŒ LÃ¼tfen gÃ¼n seÃ§in!');
                return;
            }
            if (!fullDate) {
                alert('âŒ LÃ¼tfen tarih girin!');
                return;
            }
            if (!clubName) {
                alert('âŒ LÃ¼tfen listeden geÃ§erli bir kulÃ¼p seÃ§in!\n\nÄ°pucu: KulÃ¼p alanÄ±na tÄ±klayÄ±p listeden seÃ§in.');
                return;
            }
            if (!eventTitle) {
                alert('âŒ LÃ¼tfen etkinlik baÅŸlÄ±ÄŸÄ± girin!');
                return;
            }
            if (!eventTime) {
                alert('âŒ LÃ¼tfen saat seÃ§in!');
                return;
            }
            if (!eventLocation) {
                alert('âŒ LÃ¼tfen konum girin!');
                return;
            }

            if (!events[day]) {
                events[day] = {
                    dayName: day,
                    date: fullDate,
                    isoDate: dateInputEl?.value || '',
                    events: []
                };
            } else {
                // AynÄ± gÃ¼ne yeni etkinlik eklerken tarih/isoDate bilgisini gÃ¼ncel tut
                events[day].date = fullDate;
                events[day].isoDate = dateInputEl?.value || events[day].isoDate || '';
            }

            events[day].events.push({
                clubName: clubName,
                clubIcon: clubIcon,
                eventTitle: eventTitle,
                time: eventTime,
                location: eventLocation,
                campus: campus || '',
                isOnline: isOnline
            });

            console.log('Etkinlik eklendi:', {
                day,
                clubName,
                clubIcon: clubIcon.substring ? (clubIcon.substring(0, 50) + '...') : clubIcon,
                eventTitle
            });

            renderEvents();
            // AynÄ± gÃ¼ne ardÄ±ÅŸÄ±k etkinlik eklerken tarih/gÃ¼n sÄ±fÄ±rlanmasÄ±n
            clearForm({ keepDate: true });
            scheduleSaveEventsState();
            
            // BaÅŸarÄ± mesajÄ±
            const successMsg = document.createElement('div');
            successMsg.textContent = 'âœ… Etkinlik eklendi!';
            successMsg.style.cssText = 'position: fixed; top: 20px; right: 20px; background: #28a745; color: white; padding: 15px 20px; border-radius: 8px; z-index: 10000; box-shadow: 0 4px 6px rgba(0,0,0,0.1);';
            document.body.appendChild(successMsg);
            setTimeout(() => {
                successMsg.remove();
            }, 2000);
        }

        function deleteEvent(day, index) {
            if (confirm('Bu etkinliÄŸi silmek istediÄŸinize emin misiniz?')) {
                events[day].events.splice(index, 1);
                if (events[day].events.length === 0) {
                    delete events[day];
                }
                renderEvents();
                scheduleSaveEventsState();
            }
        }

        function formatSelectedDate() {
            const dateInput = document.getElementById('fullDate');
            const formattedInput = document.getElementById('fullDateFormatted');
            const daySelect = document.getElementById('daySelect');
            
            if (dateInput.value) {
                const date = new Date(dateInput.value);
                const day = date.getDate();
                const monthNames = ['OCAK', 'ÅUBAT', 'MART', 'NÄ°SAN', 'MAYIS', 'HAZÄ°RAN', 
                                   'TEMMUZ', 'AÄUSTOS', 'EYLÃœL', 'EKÄ°M', 'KASIM', 'ARALIK'];
                const month = monthNames[date.getMonth()];
                const year = date.getFullYear();
                
                formattedInput.value = `${day} ${month} ${year}`;

                // GÃ¼n bazlÄ± hafÄ±zaya yaz
                const selectedDay = daySelect?.value;
                if (selectedDay) {
                    dayDateISO[selectedDay] = dateInput.value;
                    if (events[selectedDay]) {
                        events[selectedDay].isoDate = dateInput.value;
                        events[selectedDay].date = formattedInput.value;
                    }
                }
            } else {
                formattedInput.value = '';
            }
        }

        function suggestDateForDay() {
            const daySelect = document.getElementById('daySelect');
            const dateInput = document.getElementById('fullDate');
            const startDateInput = document.getElementById('startDate');
            
            if (!daySelect.value) return;

            // Ã–nce daha Ã¶nce bu gÃ¼n iÃ§in seÃ§ilmiÅŸ tarihi geri yÃ¼kle
            const selectedDay = daySelect.value;
            const savedIso = (events[selectedDay] && events[selectedDay].isoDate) || dayDateISO[selectedDay];
            if (savedIso) {
                dateInput.value = savedIso;
                formatSelectedDate();
                return;
            }
            
            const startDateText = startDateInput.value;
            if (startDateText) {
                const parts = startDateText.split(' ');
                if (parts.length >= 2) {
                    const day = parseInt(parts[0]);
                    const monthNames = ['OCAK', 'ÅUBAT', 'MART', 'NÄ°SAN', 'MAYIS', 'HAZÄ°RAN', 
                                       'TEMMUZ', 'AÄUSTOS', 'EYLÃœL', 'EKÄ°M', 'KASIM', 'ARALIK'];
                    const monthIndex = monthNames.indexOf(parts[1].toUpperCase());
                    
                    if (monthIndex !== -1) {
                        const currentYear = new Date().getFullYear();
                        const suggestedDate = new Date(currentYear, monthIndex, day);
                        
                        const dayNames = ['Pazar', 'Pazartesi', 'SalÄ±', 'Ã‡arÅŸamba', 'PerÅŸembe', 'Cuma', 'Cumartesi'];
                        const selectedDayIndex = dayNames.indexOf(daySelect.value);
                        
                        if (selectedDayIndex !== -1) {
                            const currentDay = suggestedDate.getDay();
                            let daysToAdd = selectedDayIndex - currentDay;
                            if (daysToAdd < 0) daysToAdd += 7;
                            
                            suggestedDate.setDate(suggestedDate.getDate() + daysToAdd);
                            
                            const year = suggestedDate.getFullYear();
                            const month = String(suggestedDate.getMonth() + 1).padStart(2, '0');
                            const date = String(suggestedDate.getDate()).padStart(2, '0');
                            
                            dateInput.value = `${year}-${month}-${date}`;
                            formatSelectedDate();
                            // Yeni Ã¶neriyi gÃ¼n bazlÄ± hafÄ±zaya yaz
                            dayDateISO[selectedDay] = dateInput.value;
                        }
                    }
                }
            }
        }

        function clearForm(options = {}) {
            const keepDate = options && options.keepDate === true;
            document.getElementById('clubName').value = '';
            updateLogoPreview('');
            document.getElementById('eventTitle').value = '';
            document.getElementById('eventTime').value = '';
            document.getElementById('eventLocation').value = '';
            document.getElementById('campusSelect').value = '';
            document.getElementById('isOnline').checked = false;
            if (!keepDate) {
                document.getElementById('fullDate').value = '';
                document.getElementById('fullDateFormatted').value = '';
            }
        }
        
        // Logo yÃ¼kleme ve base64'e Ã§evirme - Logos klasÃ¶rÃ¼nden direkt al
        async function loadLogoAsBase64(logoPath) {
            return new Promise((resolve) => {
                if (!logoPath || !logoPath.startsWith('logos/')) {
                    resolve(null);
                    return;
                }
                
                // Ã–nce sayfada bu logoyu kullanan bir img elementi var mÄ± kontrol et
                const existingImg = document.querySelector(`img[src*="${logoPath.replace('logos/', '')}"]`);
                if (existingImg && existingImg.complete && existingImg.naturalHeight > 0) {
                    // Mevcut img elementini kullan
                    try {
                        const canvas = document.createElement('canvas');
                        canvas.width = existingImg.naturalWidth;
                        canvas.height = existingImg.naturalHeight;
                        const ctx = canvas.getContext('2d');
                        ctx.drawImage(existingImg, 0, 0);
                        const base64 = canvas.toDataURL('image/png');
                        resolve(base64);
                        return;
                    } catch (e) {
                        console.warn('Mevcut img\'den base64 dÃ¶nÃ¼ÅŸtÃ¼rme hatasÄ±:', e);
                    }
                }
                
                // Yeni Image objesi oluÅŸtur
                const img = new Image();
                img.crossOrigin = 'anonymous';
                
                img.onload = () => {
                    try {
                        const canvas = document.createElement('canvas');
                        canvas.width = img.naturalWidth || img.width;
                        canvas.height = img.naturalHeight || img.height;
                        const ctx = canvas.getContext('2d');
                        ctx.drawImage(img, 0, 0);
                        const base64 = canvas.toDataURL('image/png');
                        resolve(base64);
                    } catch (e) {
                        console.warn('Base64 dÃ¶nÃ¼ÅŸtÃ¼rme hatasÄ±:', e, logoPath);
                        resolve(null);
                    }
                };
                
                img.onerror = () => {
                    console.warn('Logo yÃ¼kleme hatasÄ± (CORS olabilir):', logoPath);
                    // CORS hatasÄ± iÃ§in alternatif: base64 veritabanÄ±ndan kontrol et
                    const fileName = logoPath.replace('logos/', '');
                    // KulÃ¼p adÄ±na gÃ¶re base64 ara
                    for (const club in clubLogoBase64Database) {
                        if (clubLogoDatabase[club] === logoPath && clubLogoBase64Database[club]) {
                            console.log('Base64 veritabanÄ±ndan bulundu:', club);
                            resolve(clubLogoBase64Database[club]);
                            return;
                        }
                    }
                    resolve(null);
                };
                
                // Timeout ekle
                setTimeout(() => {
                    if (!img.complete) {
                        console.warn('Logo yÃ¼kleme timeout:', logoPath);
                        resolve(null);
                    }
                }, 5000);
                
                img.src = logoPath;
            });
        }
        
        // TasarÄ±ma DÃ¶nÃ¼ÅŸtÃ¼r - GÃ¶rseldeki gibi tasarÄ±m oluÅŸtur
        async function convertToDesign() {
            const startDate = document.getElementById('startDate').value;
            const endDate = document.getElementById('endDate').value;
            
            if (!startDate || !endDate) {
                alert('LÃ¼tfen tarih aralÄ±ÄŸÄ±nÄ± girin!');
                return;
            }
            
            const dayColors = {
                'Pazartesi': { main: '#e74c3c', light: '#fadbd8' },
                'SalÄ±': { main: '#f39c12', light: '#fdebd0' },
                'Ã‡arÅŸamba': { main: '#f1c40f', light: '#fef9e7' },
                'PerÅŸembe': { main: '#2ecc71', light: '#d5f4e6' },
                'Cuma': { main: '#3498db', light: '#d6eaf8' },
                'Cumartesi': { main: '#9b59b6', light: '#ebdef0' },
                'Pazar': { main: '#e67e22', light: '#fae5d3' }
            };

            // Logo veritabanÄ± deÄŸiÅŸmiÅŸ olabilir â†’ etkinlik logolarÄ±nÄ± gÃ¼ncelle
            refreshEventLogosFromDatabase();
            
            // Ã–nce tÃ¼m logolarÄ± base64'e Ã§evir
            const logoCache = {};
            const uniqueLogos = new Set();
            
            Object.values(events).forEach(day => {
                if (day.events) {
                    day.events.forEach(event => {
                        if (event.clubIcon && event.clubIcon.startsWith('logos/')) {
                            uniqueLogos.add(event.clubIcon);
                        } else if (event.clubIcon && event.clubIcon.startsWith('data:')) {
                            // Base64 logolarÄ± cache'e ekle (hem kulÃ¼p adÄ± hem de icon path ile)
                            if (!logoCache[event.clubName]) {
                                logoCache[event.clubName] = event.clubIcon;
                            }
                            // AyrÄ±ca event.clubIcon'u da key olarak kullan (generateDesignEvents iÃ§in)
                            if (event.clubIcon) {
                                logoCache[event.clubIcon] = event.clubIcon;
                            }
                        }
                    });
                }
            });
            
            // Loading mesajÄ± gÃ¶ster
            const preview = document.getElementById('designPreview');
            preview.style.display = 'block';
            preview.innerHTML = '<div style="text-align: center; padding: 40px; color: #666;">ğŸ”„ Logolar yÃ¼kleniyor...</div>';
            
            // Header logolarÄ±nÄ± da base64'e Ã§evir
            const headerLogos = {
                'Ã¼Ã¼logo': 'logos/Ã¼Ã¼logo.png',
                'skslogo': 'logos/SKS LOGO.png'
            };
            
            // TÃ¼m logolarÄ± yÃ¼kle (event logolarÄ± + header logolarÄ±)
            let loaded = 0;
            let total = uniqueLogos.size + Object.keys(headerLogos).length;
            
            // Event logolarÄ±nÄ± yÃ¼kle - Ã¶nce event verilerinden base64 kontrol et
            for (const logoPath of uniqueLogos) {
                let base64 = null;
                
                // Ã–nce event verilerinde base64 var mÄ± kontrol et
                Object.values(events).forEach(day => {
                    if (day.events) {
                        day.events.forEach(event => {
                            // EÄŸer event.clubIcon logoPath ile eÅŸleÅŸiyorsa ve base64 ise kullan
                            if (event.clubIcon === logoPath && event.clubIcon.startsWith('data:')) {
                                base64 = event.clubIcon;
                            }
                            // Veya event.clubIcon zaten base64 ise ve logoPath ile eÅŸleÅŸiyorsa
                            else if (event.clubIcon && event.clubIcon.startsWith('data:') && event.clubIcon.includes(logoPath.replace('logos/', ''))) {
                                base64 = event.clubIcon;
                            }
                        });
                    }
                });
                
                // Event verilerinde yoksa base64 veritabanÄ±ndan kontrol et
                if (!base64) {
                    for (const club in clubLogoBase64Database) {
                        if (clubLogoDatabase[club] === logoPath) {
                            base64 = clubLogoBase64Database[club];
                            break;
                        }
                    }
                }
                
                // Hala yoksa sayfada gÃ¶rÃ¼nen img elementini kullan
                if (!base64) {
                    const existingImg = Array.from(document.querySelectorAll('.club-icon img, .event-card img')).find(img => {
                        const src = img.src || img.getAttribute('src') || '';
                        return src.includes(logoPath.replace('logos/', '')) || src.includes(encodeURI(logoPath)) || src.startsWith('data:');
                    });
                    
                    if (existingImg && existingImg.complete && existingImg.naturalHeight > 0) {
                        try {
                            const canvas = document.createElement('canvas');
                            canvas.width = existingImg.naturalWidth;
                            canvas.height = existingImg.naturalHeight;
                            const ctx = canvas.getContext('2d');
                            ctx.drawImage(existingImg, 0, 0);
                            base64 = canvas.toDataURL('image/png');
                            console.log('âœ… Logo sayfadan base64\'e Ã§evrildi:', logoPath);
                        } catch (e) {
                            console.warn('âš ï¸ Logo canvas hatasÄ±:', e, logoPath);
                        }
                    }
                }
                
                if (base64) {
                    logoCache[logoPath] = base64;
                    loaded++;
                    console.log('âœ… Logo cache\'e eklendi:', logoPath.substring(0, 30));
                } else {
                    console.warn('âŒ Logo yÃ¼klenemedi:', logoPath);
                }
            }
            
            // Header logolarÄ±nÄ± yÃ¼kle - Ã¶nce base64 veritabanÄ±ndan kontrol et
            let headerUULogoBase64 = null;
            let headerSKSLogoBase64 = null;

            // Toplu iÃ§e aktarÄ±mdan gelen header base64 (file:// iÃ§in en gÃ¼venilir yol)
            try {
                const uuFromLS = localStorage.getItem('headerUULogoBase64');
                const sksFromLS = localStorage.getItem('headerSKSLogoBase64');
                if (uuFromLS && uuFromLS.startsWith('data:')) headerUULogoBase64 = uuFromLS;
                if (sksFromLS && sksFromLS.startsWith('data:')) headerSKSLogoBase64 = sksFromLS;
            } catch (_) {}
            
            // ÃœÃœ logo iÃ§in base64 veritabanÄ±ndan kontrol et
            if (!headerUULogoBase64) {
                for (const club in clubLogoBase64Database) {
                    if (clubLogoDatabase[club] === headerLogos.Ã¼Ã¼logo) {
                        headerUULogoBase64 = clubLogoBase64Database[club];
                        break;
                    }
                }
            }
            
            // SKS logo iÃ§in base64 veritabanÄ±ndan kontrol et
            if (!headerSKSLogoBase64) {
                for (const club in clubLogoBase64Database) {
                    if (clubLogoDatabase[club] === headerLogos.skslogo) {
                        headerSKSLogoBase64 = clubLogoBase64Database[club];
                        break;
                    }
                }
            }
            
            // Base64 veritabanÄ±nda yoksa sayfada yÃ¼klÃ¼ img elementlerini kullan
            if (!headerUULogoBase64) {
                // Ã–nce sayfada gÃ¶rÃ¼nen tÃ¼m img elementlerini kontrol et
                const allImages = Array.from(document.querySelectorAll('img'));
                console.log('Sayfada toplam img sayÄ±sÄ±:', allImages.length);
                
                const uuLogoImg = allImages.find(img => {
                    const src = img.src || img.getAttribute('src') || '';
                    const alt = img.alt || '';
                    const fileName = src.split('/').pop() || '';
                    console.log('Img kontrol:', { src: src.substring(0, 50), alt, fileName, complete: img.complete, naturalHeight: img.naturalHeight });
                    return (src.includes('Ã¼Ã¼logo') || src.includes('uu logo') || src.includes('Ã¼Ã¼') || 
                            alt.includes('ÃœÃœ') || fileName.toLowerCase().includes('Ã¼Ã¼') || fileName.toLowerCase().includes('uu')) && 
                           img.complete && img.naturalHeight > 0;
                });
                
                if (uuLogoImg) {
                    try {
                        const canvas = document.createElement('canvas');
                        canvas.width = uuLogoImg.naturalWidth;
                        canvas.height = uuLogoImg.naturalHeight;
                        const ctx = canvas.getContext('2d');
                        ctx.drawImage(uuLogoImg, 0, 0);
                        headerUULogoBase64 = canvas.toDataURL('image/png');
                        console.log('ÃœÃœ logo sayfadan base64\'e Ã§evrildi');
                        loaded++;
                    } catch (e) {
                        console.warn('ÃœÃœ logo base64 dÃ¶nÃ¼ÅŸtÃ¼rme hatasÄ±:', e);
                    }
                } else {
                    console.warn('ÃœÃœ logo sayfada bulunamadÄ±');
                }
            } else {
                loaded++;
            }
            
            if (!headerSKSLogoBase64) {
                // Ã–nce sayfada gÃ¶rÃ¼nen tÃ¼m img elementlerini kontrol et
                const allImages = Array.from(document.querySelectorAll('img'));
                const sksLogoImg = allImages.find(img => {
                    const src = img.src || img.getAttribute('src') || '';
                    const alt = img.alt || '';
                    const fileName = src.split('/').pop() || '';
                    console.log('SKS Img kontrol:', { src: src.substring(0, 50), alt, fileName, complete: img.complete, naturalHeight: img.naturalHeight });
                    return (src.includes('SKS') || src.includes('sks') || 
                            alt.includes('SKS') || alt.includes('sks') || 
                            fileName.toUpperCase().includes('SKS')) && 
                           img.complete && img.naturalHeight > 0;
                });
                
                if (sksLogoImg) {
                    try {
                        const canvas = document.createElement('canvas');
                        canvas.width = sksLogoImg.naturalWidth;
                        canvas.height = sksLogoImg.naturalHeight;
                        const ctx = canvas.getContext('2d');
                        ctx.drawImage(sksLogoImg, 0, 0);
                        headerSKSLogoBase64 = canvas.toDataURL('image/png');
                        console.log('SKS logo sayfadan base64\'e Ã§evrildi');
                        loaded++;
                    } catch (e) {
                        console.warn('SKS logo base64 dÃ¶nÃ¼ÅŸtÃ¼rme hatasÄ±:', e);
                    }
                } else {
                    console.warn('SKS logo sayfada bulunamadÄ±');
                }
            } else {
                loaded++;
            }
            
            // Hala yÃ¼klenemediyse loadLogoAsBase64 ile dene (son Ã§are - muhtemelen baÅŸarÄ±sÄ±z olacak)
            if (!headerUULogoBase64) {
                headerUULogoBase64 = await loadLogoAsBase64(headerLogos.Ã¼Ã¼logo);
                if (headerUULogoBase64) loaded++;
            }
            if (!headerSKSLogoBase64) {
                headerSKSLogoBase64 = await loadLogoAsBase64(headerLogos.skslogo);
                if (headerSKSLogoBase64) loaded++;
            }
            
            dlog(`Logolar yÃ¼klendi: ${loaded}/${total}`);
            dlog('ÃœÃœ Logo base64:', headerUULogoBase64 ? 'Var' : 'Yok');
            dlog('SKS Logo base64:', headerSKSLogoBase64 ? 'Var' : 'Yok');
            dlog('Logo cache boyutu:', Object.keys(logoCache).length);
            
            // TasarÄ±mÄ± oluÅŸtur
            preview.innerHTML = `
                <div id="designContainer" style="background: #f5f5f5; padding: 30px; border-radius: 12px; max-width: 1000px; margin: 0 auto; width: calc(100% - 80px);">
                    <div style="background: #1a5f5f; border-radius: 8px; overflow: hidden; box-shadow: 0 4px 6px rgba(0,0,0,0.1);">
                    <!-- Header -->
                    <div style="background: #1a5f5f; padding: 25px 20px; border-radius: 0; position: relative;">
                        <table role="presentation" cellspacing="0" cellpadding="0" border="0" width="100%" style="width: 100%;">
                            <tr>
                                <td width="25%" align="left" valign="middle" style="padding: 0;">
                                    <div style="width: 120px; height: 120px; border-radius: 50%; overflow: hidden; margin: 0 auto; background: white; display: flex; align-items: center; justify-content: center;">
                                        ${headerUULogoBase64 ? `<img src="${headerUULogoBase64}" alt="ÃœÃœ Logo" id="headerUULogo" style="width: 100%; height: 100%; object-fit: contain; display: block;" crossorigin="anonymous">` : '<div style="width: 100%; height: 100%; background: white; display: flex; align-items: center; justify-content: center; color: #999; font-size: 10px; text-align: center; padding: 5px;">ÃœÃœ</div>'}
                                    </div>
                                </td>
                                <td width="50%" align="center" valign="middle" style="padding: 0 30px;">
                                    <div style="color: #ffffff; font-size: 16px; font-weight: bold; margin-bottom: 8px;">ÃœSKÃœDAR ÃœNÄ°VERSÄ°TESÄ°</div>
                                    <div style="color: #ffffff; font-size: 22px; font-weight: bold;">SAÄLIK, KÃœLTÃœR VE SPOR DAÄ°RE BAÅKANLIÄI</div>
                                </td>
                                <td width="25%" align="right" valign="middle" style="padding: 0;">
                                    <div style="width: 120px; height: 120px; border-radius: 50%; overflow: hidden; margin: 0 auto; background: white; display: flex; align-items: center; justify-content: center;">
                                        ${headerSKSLogoBase64 ? `<img src="${headerSKSLogoBase64}" alt="SKS Logo" id="headerSKSLogo" style="width: 100%; height: 100%; object-fit: contain; display: block;" crossorigin="anonymous">` : '<div style="width: 100%; height: 100%; background: white; display: flex; align-items: center; justify-content: center; color: #999; font-size: 10px; text-align: center; padding: 5px;">SKS</div>'}
                                    </div>
                                </td>
                            </tr>
                        </table>
                    </div>
                    
                    <!-- Date Banner -->
                    <div style="background: #ffd700; padding: 15px; text-align: center; border-radius: 0;">
                        <div style="color: #1a5f5f; font-size: 20px; font-weight: bold;">${startDate} - ${endDate} HAFTASI</div>
                    </div>
                    
                    <!-- Events -->
                    ${generateDesignEvents(dayColors, logoCache)}
                    
                    <!-- Footer -->
                    <div style="background: #1a5f5f; padding: 20px; text-align: center; border-radius: 0; color: #ffffff; font-size: 12px;">
                        <div style="margin-bottom: 10px;">DetaylÄ± bilgi iÃ§in; <a href="https://www.sks.uskudar.edu.tr" style="color: #ffd700; text-decoration: none;">www.sks.uskudar.edu.tr</a></div>
                        <div>@uskudarsks</div>
                    </div>
                    </div>
                </div>
            `;
            
            document.getElementById('downloadBtn').style.display = 'inline-block';
            
            // TasarÄ±m oluÅŸturulduktan sonra gÃ¶rsellerin yÃ¼klendiÄŸinden emin ol
            setTimeout(async () => {
                const designContainer = document.getElementById('designContainer');
                if (designContainer) {
                    const designImages = designContainer.querySelectorAll('img');
                    dlog('ğŸ” TasarÄ±m oluÅŸturuldu, gÃ¶rsel sayÄ±sÄ±:', designImages.length);
                    
                    // TÃ¼m gÃ¶rsellerin yÃ¼klendiÄŸinden emin ol
                    const loadPromises = [];
                    designImages.forEach((img, index) => {
                        const src = img.src || img.getAttribute('src') || '';
                        dlog(`  GÃ¶rsel ${index + 1}:`, src.substring(0, 60), '| yÃ¼klÃ¼:', img.complete, '| boyut:', img.naturalWidth, 'x', img.naturalHeight);
                        
                        if (!img.complete || img.naturalHeight === 0) {
                            loadPromises.push(new Promise((resolve) => {
                                const timeout = setTimeout(() => {
                                    dwarn(`GÃ¶rsel ${index + 1} yÃ¼kleme timeout`);
                                    resolve();
                                }, 5000);
                                
                                img.onload = () => {
                                    clearTimeout(timeout);
                                    dlog(`âœ… GÃ¶rsel ${index + 1} yÃ¼klendi`);
                                    resolve();
                                };
                                
                                img.onerror = () => {
                                    clearTimeout(timeout);
                                    console.error(`âŒ GÃ¶rsel ${index + 1} yÃ¼klenemedi`);
                                    resolve();
                                };
                            }));
                        }
                    });
                    
                    await Promise.all(loadPromises);
                    dlog('âœ… TÃ¼m gÃ¶rseller hazÄ±r');
                } else {
                    console.error('âŒ designContainer bulunamadÄ±!');
                }
            }, 500);
            
            preview.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }
        
        function generateDesignEvents(dayColors, logoCache = {}) {
            const dayOrder = ['Pazartesi', 'SalÄ±', 'Ã‡arÅŸamba', 'PerÅŸembe', 'Cuma', 'Cumartesi', 'Pazar'];
            let html = '';
            
            dayOrder.forEach(day => {
                if (events[day] && events[day].events.length > 0) {
                    const dayColor = dayColors[day];
                    html += `
                        <div style="margin-top: 20px;">
                            <!-- Day Header -->
                            <div style="background: ${dayColor.main}; color: white; padding: 12px 20px; font-weight: bold; font-size: 16px; border-radius: 6px 6px 0 0;">
                                ${events[day].date} - ${day.toUpperCase()}
                            </div>
                            
                            <!-- Events Grid -->
                            <div style="background: ${dayColor.light}; padding: 15px; border-radius: 0 0 6px 6px; display: grid; grid-template-columns: repeat(5, minmax(0, 1fr)); gap: 12px;">
                                ${events[day].events.map(event => {
                                    const locationIcon = event.isOnline ? 'ğŸŒ' : 'ğŸ“';
                                    const locationColor = event.isOnline ? '#ff6b6b' : '#4a90e2';
                                    const locationText = event.isOnline ? 'ZOOM Ã‡evrimiÃ§i' : event.location;

                                    // Karakter analizi: uzun metinlerde punto kÃ¼Ã§Ã¼lt + kÄ±salt
                                    const clubFit = fitTextForDesign(event.clubName, {
                                        baseFont: 12,
                                        steps: [{ len: 28, font: 11 }, { len: 40, font: 10 }, { len: 52, font: 9 }],
                                        maxChars: 64
                                    });
                                    const titleFit = fitTextForDesign(event.eventTitle, {
                                        baseFont: 12,
                                        steps: [{ len: 26, font: 11 }, { len: 38, font: 10 }, { len: 50, font: 9 }],
                                        maxChars: 70
                                    });
                                    const locationFit = fitTextForDesign(locationText, {
                                        baseFont: 11,
                                        steps: [{ len: 34, font: 10 }, { len: 48, font: 9 }],
                                        maxChars: 80
                                    });
                                    const campusFit = fitTextForDesign(event.campus || '', {
                                        baseFont: 10,
                                        steps: [{ len: 30, font: 9 }, { len: 44, font: 8 }],
                                        maxChars: 60
                                    });
                                    
                                    let logoHTML = 'ğŸ¯';
                                    if (event.clubIcon) {
                                        if (event.clubIcon.startsWith('data:')) {
                                            // Base64 - direkt kullan
                                            logoHTML = `<img src="${event.clubIcon}" alt="Logo" style="width: 50px; height: 50px; object-fit: contain; display: block;" crossorigin="anonymous">`;
                                        } else if (event.clubIcon.startsWith('logos/')) {
                                            // Ã–nce base64 cache'den kontrol et
                                            let base64Logo = logoCache[event.clubIcon];
                                            
                                            // Cache'de yoksa base64 veritabanÄ±ndan kontrol et
                                            if (!base64Logo && event.clubName && clubLogoBase64Database[event.clubName]) {
                                                base64Logo = clubLogoBase64Database[event.clubName];
                                            }
                                            
                                            // Hala yoksa, kulÃ¼p adÄ±na gÃ¶re base64 veritabanÄ±ndan ara
                                            if (!base64Logo) {
                                                for (const club in clubLogoBase64Database) {
                                                    if (clubLogoDatabase[club] === event.clubIcon) {
                                                        base64Logo = clubLogoBase64Database[club];
                                                        break;
                                                    }
                                                }
                                            }
                                            
                                            if (base64Logo) {
                                                // Base64 logo bulundu - kullan
                                                logoHTML = `<img src="${base64Logo}" alt="Logo" style="width: 50px; height: 50px; object-fit: contain; display: block;" crossorigin="anonymous">`;
                                            } else {
                                                // Base64 yoksa Ã¶nizlemede dosya yolunu kullan (listeyle aynÄ± gÃ¶rÃ¼nsÃ¼n)
                                                // Not: file:// altÄ±nda indirme iÃ§in base64 gerekir; downloadDesign bunu kontrol ediyor.
                                                const encodedPath = encodeURI(event.clubIcon);
                                                logoHTML = `<img src="${encodedPath}" alt="Logo" style="width: 50px; height: 50px; object-fit: contain; display: block;" onerror="this.style.display='none'; this.nextElementSibling.style.display='block';"><span style="font-size: 40px; display:none;">ğŸ¯</span>`;
                                            }
                                        } else {
                                            // Emoji
                                            logoHTML = `<span style="font-size: 40px;">${event.clubIcon}</span>`;
                                        }
                                    }
                                    
                                    return `
                                        <div style="background: #2a7a7a; border-radius: 6px; padding: 15px; display: flex; gap: 12px; align-items: flex-start; min-width: 0;">
                                            <div style="width: 50px; height: 50px; background: white; border-radius: 6px; display: flex; align-items: center; justify-content: center; flex-shrink: 0;">
                                                ${logoHTML}
                                            </div>
                                            <div style="flex: 1; min-width: 0;">
                                                <div style="color: white; font-size: ${clubFit.fontSize}px; font-weight: 700; margin-bottom: 4px; line-height: 1.15; max-width: 100%; overflow: hidden; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical;">${clubFit.text}</div>
                                                <div style="color: #ffd700; font-size: ${titleFit.fontSize}px; font-weight: 700; margin-bottom: 6px; line-height: 1.15; max-width: 100%; overflow: hidden; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical;">${titleFit.text}</div>
                                                <div style="color: white; font-size: 11px; margin-bottom: 2px;">ğŸ• ${escapeHtml(event.time)}</div>
                                                <div style="color: ${locationColor}; font-size: ${locationFit.fontSize}px; line-height: 1.15; max-width: 100%; overflow: hidden; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical;">${locationIcon} ${locationFit.text}</div>
                                                ${event.campus ? `<div style="color: white; font-size: ${campusFit.fontSize}px; margin-top: 2px; opacity: 0.9; line-height: 1.15; max-width: 100%; overflow: hidden; display: -webkit-box; -webkit-line-clamp: 1; -webkit-box-orient: vertical;">${campusFit.text}</div>` : ''}
                                            </div>
                                        </div>
                                    `;
                                }).join('')}
                            </div>
                        </div>
                    `;
                }
            });
            
            return html;
        }
        
        // LogolarÄ± base64'e Ã§evir - CORS sorunlarÄ±nÄ± Ã§Ã¶zmek iÃ§in
        async function convertImageToBase64(img) {
            return new Promise((resolve) => {
                // EÄŸer zaten base64 ise direkt dÃ¶ndÃ¼r
                if (img.src.startsWith('data:')) {
                    resolve(img.src);
                    return;
                }
                
                const canvas = document.createElement('canvas');
                const ctx = canvas.getContext('2d');
                
                // Yeni bir Image objesi oluÅŸtur
                const newImg = new Image();
                newImg.crossOrigin = 'anonymous';
                
                newImg.onload = () => {
                    try {
                        canvas.width = newImg.width;
                        canvas.height = newImg.height;
                        ctx.drawImage(newImg, 0, 0);
                        const dataURL = canvas.toDataURL('image/png');
                        resolve(dataURL);
                    } catch (e) {
                        console.warn('Base64 dÃ¶nÃ¼ÅŸtÃ¼rme hatasÄ±:', e);
                        resolve(null);
                    }
                };
                
                newImg.onerror = () => {
                    console.warn('Logo yÃ¼kleme hatasÄ±:', img.src);
                    resolve(null);
                };
                
                // EÄŸer zaten yÃ¼klenmiÅŸse
                if (img.complete && img.naturalHeight !== 0) {
                    newImg.src = img.src;
                } else {
                    img.addEventListener('load', () => {
                        newImg.src = img.src;
                    }, { once: true });
                    img.addEventListener('error', () => {
                        resolve(null);
                    }, { once: true });
                    // Tekrar yÃ¼kle
                    const originalSrc = img.src;
                    img.src = '';
                    img.src = originalSrc;
                }
            });
        }
        
        // TasarÄ±mdaki tÃ¼m logolarÄ± base64'e Ã§evir
        async function convertAllLogosToBase64() {
            const container = document.getElementById('designContainer');
            if (!container) {
                console.warn('designContainer bulunamadÄ±!');
                return;
            }
            
            // TÃ¼m img elementlerini bul
            const images = container.querySelectorAll('img');
            console.log('Toplam gÃ¶rsel sayÄ±sÄ±:', images.length);
            
            if (images.length === 0) {
                console.warn('HiÃ§ gÃ¶rsel bulunamadÄ±!');
                return;
            }
            
            // TÃ¼m gÃ¶rselleri canvas ile base64'e Ã§evir (CORS sorununu Ã§Ã¶zmek iÃ§in)
            const loadPromises = [];
            images.forEach((img, index) => {
                const currentSrc = img.src || img.getAttribute('src') || '';
                console.log(`GÃ¶rsel ${index + 1}:`, currentSrc.substring(0, 80));
                
                // EÄŸer zaten base64 ise atla
                if (currentSrc && currentSrc.startsWith('data:')) {
                    console.log(`GÃ¶rsel ${index + 1} zaten base64`);
                    return;
                }
                
                // GÃ¶rsel yÃ¼klenmiÅŸse canvas ile base64'e Ã§evir
                if (img.complete && img.naturalHeight > 0) {
                    loadPromises.push(new Promise((resolve) => {
                        try {
                            const canvas = document.createElement('canvas');
                            canvas.width = img.naturalWidth;
                            canvas.height = img.naturalHeight;
                            const ctx = canvas.getContext('2d');
                            ctx.drawImage(img, 0, 0);
                            const base64 = canvas.toDataURL('image/png');
                            img.src = base64;
                            console.log(`GÃ¶rsel ${index + 1} base64'e Ã§evrildi (canvas - yÃ¼klÃ¼)`);
                            resolve();
                        } catch (e) {
                            console.warn(`GÃ¶rsel ${index + 1} canvas hatasÄ±:`, e);
                            resolve();
                        }
                    }));
                } else {
                    // GÃ¶rsel henÃ¼z yÃ¼klenmemiÅŸse bekle
                    loadPromises.push(new Promise((resolve) => {
                        const timeout = setTimeout(() => {
                            console.warn(`GÃ¶rsel ${index + 1} yÃ¼kleme timeout`);
                            resolve();
                        }, 5000);
                        
                        const onLoad = () => {
                            clearTimeout(timeout);
                            try {
                                const canvas = document.createElement('canvas');
                                canvas.width = img.naturalWidth;
                                canvas.height = img.naturalHeight;
                                const ctx = canvas.getContext('2d');
                                ctx.drawImage(img, 0, 0);
                                const base64 = canvas.toDataURL('image/png');
                                img.src = base64;
                                console.log(`GÃ¶rsel ${index + 1} base64'e Ã§evrildi (canvas - onload)`);
                                resolve();
                            } catch (e) {
                                console.warn(`GÃ¶rsel ${index + 1} canvas hatasÄ±:`, e);
                                resolve();
                            }
                        };
                        
                        if (img.complete) {
                            onLoad();
                        } else {
                            img.addEventListener('load', onLoad, { once: true });
                            img.addEventListener('error', () => {
                                clearTimeout(timeout);
                                console.warn(`GÃ¶rsel ${index + 1} yÃ¼klenemedi`);
                                resolve();
                            }, { once: true });
                        }
                    }));
                }
            });
            
            await Promise.all(loadPromises);
            const convertedCount = Array.from(images).filter(img => {
                const src = img.src || img.getAttribute('src') || '';
                return src.startsWith('data:');
            }).length;
            console.log('Base64 dÃ¶nÃ¼ÅŸÃ¼mÃ¼ tamamlandÄ±, yÃ¼klenen:', convertedCount, '/', images.length);
            
            // Ekstra bekleme - gÃ¶rsellerin render edilmesi iÃ§in
            await new Promise(resolve => setTimeout(resolve, 2000));
        }
        
        // TÃ¼m gÃ¶rsellerin yÃ¼klendiÄŸinden emin ol
        async function waitForImages(container) {
            const images = container.querySelectorAll('img');
            const promises = [];
            
            images.forEach(img => {
                if (img.complete && img.naturalHeight !== 0) {
                    return; // Zaten yÃ¼klenmiÅŸ
                }
                
                promises.push(new Promise((resolve) => {
                    img.onload = resolve;
                    img.onerror = resolve; // Hata olsa bile devam et
                    // Timeout ekle
                    setTimeout(resolve, 3000);
                }));
            });
            
            await Promise.all(promises);
        }
        
        // TasarÄ±mÄ± Ä°ndir
        async function downloadDesign() {
            // Ã–nce designContainer'Ä± bul
            let container = document.getElementById('designContainer');
            
            // EÄŸer bulunamazsa, preview iÃ§inde ara
            if (!container) {
                const preview = document.getElementById('designPreview');
                if (preview) {
                    container = preview.querySelector('#designContainer');
                }
            }
            
            if (!container) {
                alert('Ã–nce tasarÄ±mÄ± oluÅŸturun! "TasarÄ±ma DÃ¶nÃ¼ÅŸtÃ¼r" butonuna tÄ±klayÄ±n.');
                return;
            }
            
            dlog('Container bulundu:', container);
            dlog('Container iÃ§indeki img sayÄ±sÄ±:', container.querySelectorAll('img').length);
            
            try {
                // Loading mesajÄ± gÃ¶ster
                const downloadBtn = document.getElementById('downloadBtn');
                const originalText = downloadBtn.textContent;
                downloadBtn.textContent = 'â³ YÃ¼kleniyor...';
                downloadBtn.disabled = true;
                
                // html2canvas kÃ¼tÃ¼phanesini dinamik yÃ¼kle
                if (typeof html2canvas === 'undefined') {
                    const script = document.createElement('script');
                    script.src = 'https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js';
                    document.head.appendChild(script);
                    await new Promise((resolve) => {
                        script.onload = resolve;
                    });
                }
                
                // TÃ¼m gÃ¶rsellerin yÃ¼klendiÄŸinden emin ol
                dlog('GÃ¶rseller kontrol ediliyor...');
                const images = container.querySelectorAll('img');
                dlog('Toplam gÃ¶rsel sayÄ±sÄ±:', images.length);
                if (images.length === 0) {
                    // TasarÄ±m img iÃ§ermese bile indirilebilir.
                    dlog('â„¹ï¸ TasarÄ±mda <img> yok. Render/indirme devam edecek.');
                }

                // file:// altÄ±nda base64 olmayan img varsa indirme boÅŸ Ã§Ä±kabilir â†’ erken uyarÄ±
                const isFileProtocol = (window.location && window.location.protocol === 'file:');
                if (isFileProtocol) {
                    const nonBase64 = Array.from(images).filter(img => {
                        const src = img.src || img.getAttribute('src') || '';
                        return src && !src.startsWith('data:');
                    });
                    if (nonBase64.length > 0) {
                        alert(`âš ï¸ Ä°ndirme engellendi: BazÄ± logolar base64 deÄŸil.\n\nNeden: Chrome, file:// altÄ±nda dosya yolundaki gÃ¶rselleri canvas'a Ã§izdirmiyor.\n\nÃ‡Ã¶zÃ¼m:\n- Logo YÃ¶netim Paneli â†’ Toplu Logo Ä°Ã§e Aktar (KlasÃ¶r SeÃ§)\nveya\n- Ä°lgili kulÃ¼bÃ¼ seÃ§ip logo yÃ¼kle â†’ Kaydet\n\nSonra tekrar â€œTasarÄ±ma DÃ¶nÃ¼ÅŸtÃ¼râ€ â†’ â€œTasarÄ±mÄ± Ä°ndirâ€.`);
                        downloadBtn.textContent = originalText;
                        downloadBtn.disabled = false;
                        return;
                    }
                }
                
                // TÃ¼m gÃ¶rsellerin yÃ¼klendiÄŸinden emin ol
                const imagePromises = [];
                images.forEach((img, index) => {
                    const src = img.src || img.getAttribute('src') || '';
                    dlog(`GÃ¶rsel ${index + 1} src:`, src.substring(0, 50), '| base64:', src.startsWith('data:'));
                    
                    // GÃ¶rselin yÃ¼klendiÄŸinden emin ol
                    if (img.complete && img.naturalHeight > 0 && img.naturalWidth > 0) {
                        dlog(`âœ… GÃ¶rsel ${index + 1} yÃ¼klÃ¼ (${img.naturalWidth}x${img.naturalHeight})`);
                    } else {
                        imagePromises.push(new Promise((resolve) => {
                            const timeout = setTimeout(() => {
                                dwarn(`âš ï¸ GÃ¶rsel ${index + 1} yÃ¼kleme timeout`);
                                resolve();
                            }, 5000);
                            
                            const checkLoaded = () => {
                                if (img.complete && img.naturalHeight > 0 && img.naturalWidth > 0) {
                                    clearTimeout(timeout);
                                    dlog(`âœ… GÃ¶rsel ${index + 1} yÃ¼klendi (${img.naturalWidth}x${img.naturalHeight})`);
                                    resolve();
                                }
                            };
                            
                            img.onload = checkLoaded;
                            img.onerror = () => {
                                clearTimeout(timeout);
                                console.error(`âŒ GÃ¶rsel ${index + 1} yÃ¼klenemedi`);
                                resolve();
                            };
                            
                            if (img.complete) {
                                checkLoaded();
                            }
                        }));
                    }
                });
                
                await Promise.all(imagePromises);
                dlog('âœ… TÃ¼m gÃ¶rseller yÃ¼klendi');
                
                // Ekstra bekleme - render iÃ§in
                if (document.fonts && document.fonts.ready) {
                    try { await document.fonts.ready; } catch (_) {}
                }
                await new Promise(resolve => requestAnimationFrame(() => requestAnimationFrame(resolve)));
                
                dlog('Canvas oluÅŸturuluyor...');
                
                // html2canvas iÃ§in basit ayarlar - gÃ¶rseller zaten base64
                const canvas = await html2canvas(container, {
                    backgroundColor: '#f5f5f5',
                    scale: 2,
                    logging: false,
                    useCORS: true,
                    allowTaint: true,
                    foreignObjectRendering: false,
                    imageTimeout: 30000
                });
                
                dlog('Canvas oluÅŸturuldu, boyut:', canvas.width, 'x', canvas.height);
                
                // Canvas'Ä±n boÅŸ olup olmadÄ±ÄŸÄ±nÄ± kontrol et - daha kapsamlÄ± kontrol
                const ctx = canvas.getContext('2d');
                const sampleSize = Math.min(200, Math.min(canvas.width, canvas.height));
                const imageData = ctx.getImageData(0, 0, sampleSize, sampleSize);
                const pixels = imageData.data;
                let hasContent = false;
                let nonTransparentPixels = 0;
                
                for (let i = 0; i < pixels.length; i += 4) {
                    // Alpha deÄŸeri 0'dan bÃ¼yÃ¼kse iÃ§erik var demektir
                    if (pixels[i + 3] > 10) { // 10'dan bÃ¼yÃ¼k alpha deÄŸeri (tamamen ÅŸeffaf deÄŸil)
                        nonTransparentPixels++;
                        if (nonTransparentPixels > 100) { // En az 100 piksel iÃ§erik var
                            hasContent = true;
                            break;
                        }
                    }
                }
                
                if (!hasContent) {
                    console.error('âš ï¸ Canvas boÅŸ gÃ¶rÃ¼nÃ¼yor! Toplam iÃ§erikli piksel:', nonTransparentPixels);
                    console.error('Canvas boyutu:', canvas.width, 'x', canvas.height);
                    alert('UyarÄ±: Ä°ndirilen gÃ¶rsel boÅŸ gÃ¶rÃ¼nÃ¼yor. LÃ¼tfen console loglarÄ±nÄ± kontrol edin ve "TasarÄ±ma DÃ¶nÃ¼ÅŸtÃ¼r" butonuna tekrar tÄ±klayÄ±n.');
                    downloadBtn.textContent = originalText;
                    downloadBtn.disabled = false;
                    return;
                } else {
                    dlog('âœ… Canvas iÃ§erik iÃ§eriyor (', nonTransparentPixels, 'piksel)');
                }
                
                const link = document.createElement('a');
                link.download = `etkinlik-programi-${Date.now()}.png`;
                link.href = canvas.toDataURL('image/png', 1.0);
                link.click();
                
                dlog('TasarÄ±m indirildi!');
                
                // Butonu eski haline getir
                downloadBtn.textContent = originalText;
                downloadBtn.disabled = false;
                
            } catch (error) {
                console.error('Ä°ndirme hatasÄ±:', error);
                alert('Ä°ndirme sÄ±rasÄ±nda bir hata oluÅŸtu: ' + error.message);
                
                // Butonu eski haline getir
                const downloadBtn = document.getElementById('downloadBtn');
                if (downloadBtn) {
                    downloadBtn.textContent = 'ğŸ’¾ TasarÄ±mÄ± Ä°ndir';
                    downloadBtn.disabled = false;
                }
            }
        }
        
        function updateLogoPreview(clubName) {
            const logoPreview = document.getElementById('logoPreview');
            if (!logoPreview) return;
            
            const logoSrc = getLogoSource(clubName);
            if (logoSrc) {
                if (logoSrc.startsWith('data:')) {
                    // Base64
                    logoPreview.innerHTML = `<img src="${logoSrc}" alt="Logo" style="max-width: 50px; max-height: 50px; object-fit: contain;">`;
                } else if (logoSrc.startsWith('logos/')) {
                    // Dosya yolu
                    logoPreview.innerHTML = `<img src="${logoSrc}" alt="Logo" style="max-width: 50px; max-height: 50px; object-fit: contain;" onerror="this.style.display='none'; this.nextElementSibling.style.display='block';"><span style="display:none; font-size: 28px;">ğŸ¯</span>`;
                } else {
                    // Emoji
                    logoPreview.innerHTML = `<span style="font-size: 28px;">${logoSrc}</span>`;
                }
            } else {
                logoPreview.innerHTML = `<span style="font-size: 28px;">ğŸ¯</span>`;
            }
        }

        function makeEditable(element, field, day, index) {
            element.addEventListener('dblclick', () => {
                if (element.classList.contains('editing')) return;
                
                const originalText = element.textContent.replace(/ğŸ•|ğŸ“|ğŸŒ/g, '').trim();
                const input = document.createElement('input');
                input.type = 'text';
                input.value = originalText;
                input.style.width = '100%';
                input.style.border = '1px solid #ffc107';
                input.style.padding = '4px';
                input.style.borderRadius = '3px';
                input.style.fontSize = 'inherit';
                input.style.fontFamily = 'inherit';
                
                element.classList.add('editing');
                element.innerHTML = '';
                element.appendChild(input);
                input.focus();
                input.select();
                
                const save = () => {
                    const newValue = input.value.trim();
                    if (newValue && newValue !== originalText) {
                        if (field === 'clubName') {
                            const canon = canonicalizeClubName(newValue);
                            if (!canon) {
                                alert('âŒ GeÃ§ersiz kulÃ¼p adÄ±.\n\nLÃ¼tfen resmÃ® listeden bir kulÃ¼p seÃ§in.');
                                element.classList.remove('editing');
                                renderEvents();
                                return;
                            }
                            events[day].events[index].clubName = canon;
                            const logoSrc = getLogoSource(canon);
                            events[day].events[index].clubIcon = logoSrc || 'ğŸ¯';
                        } else if (field === 'eventTitle') {
                            events[day].events[index].eventTitle = newValue;
                        } else if (field === 'time') {
                            events[day].events[index].time = newValue;
                        } else if (field === 'location') {
                            events[day].events[index].location = newValue;
                        } else if (field === 'campus') {
                            events[day].events[index].campus = newValue;
                        }
                        renderEvents();
                        scheduleSaveEventsState();
                    } else {
                        element.classList.remove('editing');
                        renderEvents();
                    }
                };
                
                input.addEventListener('blur', save);
                input.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') {
                        save();
                    }
                });
            });
        }

        function setupDragAndDrop() {
            const cards = document.querySelectorAll('.event-card');
            cards.forEach(card => {
                card.draggable = true;
                card.addEventListener('dragstart', (e) => {
                    draggedElement = card;
                    card.classList.add('dragging');
                    e.dataTransfer.effectAllowed = 'move';
                });
                
                card.addEventListener('dragend', () => {
                    card.classList.remove('dragging');
                    // DOM sÄ±ralamasÄ±nÄ± events verisine yaz
                    try {
                        const day = card.dataset.day;
                        const grid = card.parentElement;
                        if (day && grid && events[day] && Array.isArray(events[day].events)) {
                            const current = [...events[day].events];
                            const order = Array.from(grid.querySelectorAll('.event-card'))
                                .map(el => parseInt(el.dataset.index, 10))
                                .filter(n => Number.isFinite(n));
                            if (order.length === current.length) {
                                events[day].events = order.map(i => current[i]).filter(Boolean);
                                // indeksleri gÃ¼ncellemek iÃ§in yeniden Ã§iz
                                renderEvents();
                                scheduleSaveEventsState();
                            }
                        }
                    } catch (_) {}
                    draggedElement = null;
                });
                
                card.addEventListener('dragover', (e) => {
                    e.preventDefault();
                    e.dataTransfer.dropEffect = 'move';
                    const afterElement = getDragAfterElement(card.parentElement, e.clientX);
                    if (afterElement == null) {
                        card.parentElement.appendChild(draggedElement);
                    } else {
                        card.parentElement.insertBefore(draggedElement, afterElement);
                    }
                });
            });
        }

        function getDragAfterElement(container, x) {
            const draggableElements = [...container.querySelectorAll('.event-card:not(.dragging)')];
            return draggableElements.reduce((closest, child) => {
                const box = child.getBoundingClientRect();
                const offset = x - box.left - box.width / 2;
                if (offset < 0 && offset > closest.offset) {
                    return { offset: offset, element: child };
                } else {
                    return closest;
                }
            }, { offset: Number.NEGATIVE_INFINITY }).element;
        }

        function renderEvents() {
            console.log('renderEvents Ã§aÄŸrÄ±ldÄ±, events:', events);
            const container = document.getElementById('eventsList');
            if (!container) {
                console.error('eventsList container bulunamadÄ±!');
                return;
            }
            container.innerHTML = '';

            const dayOrder = ['Pazartesi', 'SalÄ±', 'Ã‡arÅŸamba', 'PerÅŸembe', 'Cuma', 'Cumartesi', 'Pazar'];
            const dayClasses = {
                'Pazartesi': 'pazartesi',
                'SalÄ±': 'sali',
                'Ã‡arÅŸamba': 'carsamba',
                'PerÅŸembe': 'persembe',
                'Cuma': 'cuma',
                'Cumartesi': 'cumartesi',
                'Pazar': 'pazar'
            };
            
            dayOrder.forEach(day => {
                if (events[day] && events[day].events.length > 0) {
                    const daySection = document.createElement('div');
                    daySection.className = `day-section ${dayClasses[day]}`;
                    
                    const dayHeader = document.createElement('div');
                    dayHeader.className = 'day-header';
                    dayHeader.textContent = `${events[day].date} - ${day.toUpperCase()}`;
                    
                    dayHeader.addEventListener('dblclick', () => {
                        const input = document.createElement('input');
                        input.value = dayHeader.textContent;
                        input.style.width = '100%';
                        input.style.border = 'none';
                        input.style.background = 'transparent';
                        input.style.color = 'inherit';
                        input.style.fontSize = 'inherit';
                        input.style.fontWeight = 'inherit';
                        dayHeader.classList.add('editing');
                        dayHeader.innerHTML = '';
                        dayHeader.appendChild(input);
                        input.focus();
                        input.select();
                        
                        input.addEventListener('blur', () => {
                            events[day].date = input.value;
                            dayHeader.classList.remove('editing');
                            renderEvents();
                        });
                        
                        input.addEventListener('keypress', (e) => {
                            if (e.key === 'Enter') {
                                input.blur();
                            }
                        });
                    });
                    
                    daySection.appendChild(dayHeader);

                    const eventsGrid = document.createElement('div');
                    eventsGrid.className = 'events-grid';

                    events[day].events.forEach((event, index) => {
                        const eventCard = document.createElement('div');
                        eventCard.className = 'event-card';
                        eventCard.draggable = true;
                        eventCard.dataset.day = day;
                        eventCard.dataset.index = index;
                        
                        const locationIcon = event.isOnline ? 'ğŸŒ' : 'ğŸ“';
                        const locationClass = event.isOnline ? 'online' : '';
                        
                        let clubIconDisplay = 'ğŸ¯';
                        console.log('Event logo render:', event.clubName, 'clubIcon:', event.clubIcon ? (event.clubIcon.substring ? event.clubIcon.substring(0, 30) + '...' : event.clubIcon) : 'yok');
                        
                        if (event.clubIcon) {
                            if (typeof event.clubIcon === 'string' && event.clubIcon.startsWith('data:')) {
                                // Base64
                                clubIconDisplay = `<img src="${event.clubIcon}" alt="Logo" style="width: 50px; height: 50px; object-fit: contain; display: block;" onerror="this.style.display='none'; this.nextElementSibling.style.display='block';"><span style="font-size: 40px; display: none;">ğŸ¯</span>`;
                            } else if (typeof event.clubIcon === 'string' && event.clubIcon.startsWith('logos/')) {
                                // Dosya yolu - TÃ¼rkÃ§e karakterler ve boÅŸluklar iÃ§in encode
                                const encodedPath = encodeURI(event.clubIcon).replace(/'/g, '%27');
                                clubIconDisplay = `<img src="${encodedPath}" alt="Logo" style="width: 50px; height: 50px; object-fit: contain; display: block;" onload="this.style.display='block'; this.nextElementSibling.style.display='none';" onerror="this.style.display='none'; this.nextElementSibling.style.display='block'; console.error('Logo yÃ¼klenemedi:', '${encodedPath}');"><span style="font-size: 40px; display: none;">ğŸ¯</span>`;
                            } else if (typeof event.clubIcon === 'string') {
                                // Emoji veya diÄŸer string
                                clubIconDisplay = `<span style="font-size: 40px;">${event.clubIcon}</span>`;
                            }
                        } else {
                            // Logo yoksa, tekrar getLogoSource ile dene
                            const logoSrc = getLogoSource(event.clubName);
                            if (logoSrc) {
                                if (logoSrc.startsWith('data:')) {
                                    clubIconDisplay = `<img src="${logoSrc}" alt="Logo" style="width: 50px; height: 50px; object-fit: contain; display: block;" onerror="this.style.display='none'; this.nextElementSibling.style.display='block';"><span style="font-size: 40px; display: none;">ğŸ¯</span>`;
                                } else if (logoSrc.startsWith('logos/')) {
                                    const encodedPath = encodeURI(logoSrc).replace(/'/g, '%27');
                                    clubIconDisplay = `<img src="${encodedPath}" alt="Logo" style="width: 50px; height: 50px; object-fit: contain; display: block;" onload="this.style.display='block'; this.nextElementSibling.style.display='none';" onerror="this.style.display='none'; this.nextElementSibling.style.display='block'; console.error('Logo yÃ¼klenemedi:', '${encodedPath}');"><span style="font-size: 40px; display: none;">ğŸ¯</span>`;
                                } else {
                                    clubIconDisplay = `<span style="font-size: 40px;">${logoSrc}</span>`;
                                }
                            } else {
                                // Logo yoksa emoji gÃ¶ster
                                clubIconDisplay = `<span style="font-size: 40px;">ğŸ¯</span>`;
                            }
                        }
                        
                        const locationText = event.isOnline ? 'ZOOM Ã‡evrimiÃ§i' : event.location;
                        const campusText = event.campus ? event.campus : '';
                        
                        eventCard.innerHTML = `
                            <button class="delete-btn" onclick="deleteEvent('${day}', ${index})">Ã—</button>
                            <div class="club-icon">${clubIconDisplay}</div>
                            <div class="event-content">
                                <div class="club-name">${event.clubName}</div>
                                <div class="event-title">${event.eventTitle}</div>
                                <div class="event-time">ğŸ• ${event.time}</div>
                                <div class="event-location ${locationClass}">${locationIcon} ${locationText}</div>
                                ${campusText ? `<div class="event-campus" style="font-size: 10px; color: #666; margin-top: 2px;">${campusText}</div>` : ''}
                            </div>
                        `;
                        
                        const clubNameEl = eventCard.querySelector('.club-name');
                        const eventTitleEl = eventCard.querySelector('.event-title');
                        const eventTimeEl = eventCard.querySelector('.event-time');
                        const eventLocationEl = eventCard.querySelector('.event-location');
                        
                        makeEditable(clubNameEl, 'clubName', day, index);
                        makeEditable(eventTitleEl, 'eventTitle', day, index);
                        makeEditable(eventTimeEl, 'time', day, index);
                        makeEditable(eventLocationEl, 'location', day, index);
                        const eventCampusEl = eventCard.querySelector('.event-campus');
                        if (eventCampusEl) {
                            makeEditable(eventCampusEl, 'campus', day, index);
                        }
                        
                        eventsGrid.appendChild(eventCard);
                    });

                    daySection.appendChild(eventsGrid);
                    container.appendChild(daySection);
                }
            });
            
            setupDragAndDrop();
        }

        function initClubList() {
            const datalist = document.getElementById('clubList');
            clubNames.forEach(club => {
                const option = document.createElement('option');
                option.value = club;
                datalist.appendChild(option);
            });
        }

        function filterClubList() {
            const input = document.getElementById('clubName');
            const valueNorm = normalizeKey(input.value || '');
            const datalist = document.getElementById('clubList');
            
            datalist.innerHTML = '';
            clubNames.filter(club => normalizeKey(club).includes(valueNorm)).forEach(club => {
                const option = document.createElement('option');
                option.value = club;
                datalist.appendChild(option);
            });
        }

        function initTimeSelector() {
            const timeSelect = document.getElementById('eventTime');
            if (!timeSelect) return;
            
            for (let hour = 1; hour <= 23; hour++) {
                const hourStr = hour.toString().padStart(2, '0');
                const option1 = document.createElement('option');
                option1.value = `${hourStr}:00`;
                option1.textContent = `${hourStr}:00`;
                timeSelect.appendChild(option1);
                
                const option2 = document.createElement('option');
                option2.value = `${hourStr}:30`;
                option2.textContent = `${hourStr}:30`;
                timeSelect.appendChild(option2);
            }
            
            const option24 = document.createElement('option');
            option24.value = '24:00';
            option24.textContent = '24:00';
            timeSelect.appendChild(option24);
        }

        function setupClubAutoSelect() {
            const clubNameInput = document.getElementById('clubName');
            if (clubNameInput) {
                clubNameInput.addEventListener('change', function() {
                    const canon = canonicalizeClubName(this.value);
                    if (canon) this.value = canon;
                    updateLogoPreview(this.value);
                });
                clubNameInput.addEventListener('input', function() {
                    setTimeout(() => {
                        updateLogoPreview(this.value);
                    }, 100);
                });
            }
        }


        // Logo YÃ¶netim Paneli
        function openLogoManager() {
            const modal = document.getElementById('logoManagerModal');
            if (!modal) return;
            
            modal.style.display = 'flex';
            // Header logo Ã¶nizlemelerini yÃ¼kle
            try { renderHeaderLogoManagerPreviews(); } catch (_) {}
            
            // KulÃ¼p listesini doldur
            const clubSelect = document.getElementById('logoManagerClubSelect');
            clubSelect.innerHTML = '<option value="">KulÃ¼p seÃ§in...</option>';
            clubNames.forEach(club => {
                const option = document.createElement('option');
                option.value = club;
                option.textContent = club;
                clubSelect.appendChild(option);
            });
            
            // Mevcut eÅŸleÅŸtirmeleri gÃ¶ster
            displayLogoMappings();
            
            // KulÃ¼p seÃ§ildiÄŸinde mevcut logoyu gÃ¶ster
            clubSelect.addEventListener('change', function() {
                const selectedClub = this.value;
                if (selectedClub && clubLogoDatabase[selectedClub]) {
                    const logoPath = clubLogoDatabase[selectedClub];
                    document.getElementById('logoManagerFileName').value = logoPath.replace('logos/', '');
                    updateLogoManagerPreview(logoPath);
                } else {
                    document.getElementById('logoManagerFileName').value = '';
                    document.getElementById('logoManagerPreview').innerHTML = '<span style="color: #999;">Logo Ã¶nizlemesi burada gÃ¶rÃ¼necek</span>';
                }
            });
            
            // Dosya adÄ± deÄŸiÅŸtiÄŸinde Ã¶nizleme gÃ¼ncelle
            const fileNameInput = document.getElementById('logoManagerFileName');
            if (fileNameInput) {
                fileNameInput.addEventListener('input', function() {
                    const fileName = this.value.trim();
                    if (fileName) {
                        const logoPath = 'logos/' + fileName;
                        updateLogoManagerPreview(logoPath);
                    } else {
                        document.getElementById('logoManagerPreview').innerHTML = '<span style="color: #999;">Logo Ã¶nizlemesi burada gÃ¶rÃ¼necek</span>';
                    }
                });
            }
            
            // Upload area'yÄ± sÄ±fÄ±rla
            const uploadArea = document.getElementById('logoUploadArea');
            if (uploadArea) {
                uploadArea.innerHTML = `
                    <input type="file" id="logoFileInput" accept="image/png,image/jpeg,image/jpg" style="display: none;" onchange="handleLogoFileSelect(event)">
                    <div id="uploadAreaContent">
                        <div style="font-size: 48px; margin-bottom: 10px;">ğŸ“¤</div>
                        <div style="color: #1a5f5f; font-weight: bold; margin-bottom: 5px;">Logo DosyasÄ±nÄ± SÃ¼rÃ¼kleyip BÄ±rakÄ±n</div>
                        <div style="color: #666; font-size: 13px;">veya tÄ±klayarak seÃ§in</div>
                        <div style="color: #999; font-size: 12px; margin-top: 8px;">PNG, JPG formatlarÄ± desteklenir</div>
                    </div>
                `;
                uploadArea.onclick = function() {
                    document.getElementById('logoFileInput').click();
                };
            }
        }
        
        function closeLogoManager() {
            const modal = document.getElementById('logoManagerModal');
            if (modal) {
                modal.style.display = 'none';
            }
        }
        
        // Dosya YÃ¼kleme FonksiyonlarÄ±
        function normalizeKey(str) {
            return (str || '')
                .toString()
                .trim()
                .toLowerCase()
                .replace(/Ä±/g, 'i')
                .replace(/Ä°/g, 'i')
                .replace(/ÅŸ/g, 's')
                .replace(/ÄŸ/g, 'g')
                .replace(/Ã¼/g, 'u')
                .replace(/Ã¶/g, 'o')
                .replace(/Ã§/g, 'c')
                .replace(/[^a-z0-9]+/g, '');
        }

        function baseNameFromPath(p) {
            return ((p || '').split('/').pop()) || '';
        }

        function normalizeClubNameForMatch(clubName) {
            // "KulÃ¼bÃ¼/Kulubu/Club" gibi ekleri kÄ±rp, kalanla normalize et
            const s = (clubName || '')
                .toString()
                .trim()
                .replace(/\bkulÃ¼bÃ¼\b/ig, '')
                .replace(/\bkulubu\b/ig, '')
                .replace(/\bclub\b/ig, '')
                .replace(/\bkulup\b/ig, '')
                .replace(/\s+/g, ' ')
                .trim();
            return normalizeKey(s);
        }

        function findBestLogoBase64ForClub(fileBase64ByNormName, clubName, mappedPath) {
            if (!fileBase64ByNormName) return null;

            // 1) Mapping path dosya adÄ±na gÃ¶re birebir
            const mappedNorm = normalizeKey(baseNameFromPath(mappedPath).replace(/\.[^.]+$/, ''));
            if (mappedNorm && fileBase64ByNormName[mappedNorm]) return fileBase64ByNormName[mappedNorm];

            // 2) KulÃ¼p adÄ±na gÃ¶re birebir
            const clubNorm = normalizeClubNameForMatch(clubName);
            if (clubNorm && fileBase64ByNormName[clubNorm]) return fileBase64ByNormName[clubNorm];

            // 3) "contains" eÅŸleÅŸme (en uzun ortak parÃ§a kazanÄ±r)
            let bestKey = null;
            let bestScore = 0;
            const keys = Object.keys(fileBase64ByNormName);

            for (const k of keys) {
                if (!k) continue;
                // mapping veya kulÃ¼p normu k'yi iÃ§eriyorsa veya tersi
                const score =
                    (mappedNorm && (k.includes(mappedNorm) || mappedNorm.includes(k)) ? Math.min(k.length, mappedNorm.length) : 0) +
                    (clubNorm && (k.includes(clubNorm) || clubNorm.includes(k)) ? Math.min(k.length, clubNorm.length) : 0);

                if (score > bestScore) {
                    bestScore = score;
                    bestKey = k;
                }
            }

            if (bestKey && bestScore >= 6) return fileBase64ByNormName[bestKey];
            return null;
        }

        async function handleLogoFolderSelect(e) {
            const files = Array.from(e.target.files || []);
            const statusEl = document.getElementById('bulkImportStatus');
            if (statusEl) statusEl.textContent = '';
            if (!files.length) return;

            const imageFiles = files.filter(f => (f.type || '').startsWith('image/'));
            if (!imageFiles.length) {
                alert('âŒ KlasÃ¶rde gÃ¶rsel bulunamadÄ± (PNG/JPG).');
                return;
            }

            if (statusEl) statusEl.textContent = `â³ ${imageFiles.length} dosya okunuyor... (0/${imageFiles.length})`;

            const fileBase64ByNormName = {};
            // Seri oku: hem ilerleme gÃ¶stermek hem de tarayÄ±cÄ±yÄ± kilitlememek iÃ§in
            for (let i = 0; i < imageFiles.length; i++) {
                const file = imageFiles[i];
                // eslint-disable-next-line no-await-in-loop
                await new Promise((resolve) => {
                    const reader = new FileReader();
                    reader.onload = () => {
                        const base64 = reader.result;
                        const norm = normalizeKey(file.name.replace(/\.[^.]+$/, ''));
                        if (typeof base64 === 'string' && base64.startsWith('data:')) {
                            fileBase64ByNormName[norm] = base64;
                        }
                        resolve();
                    };
                    reader.onerror = () => resolve();
                    reader.readAsDataURL(file);
                });
                if (statusEl && (i % 5 === 0 || i === imageFiles.length - 1)) {
                    statusEl.textContent = `â³ ${imageFiles.length} dosya okunuyor... (${i + 1}/${imageFiles.length})`;
                }
            }

            let matched = 0;
            let totalMapped = 0;
            let correctedByName = 0;

            Object.keys(clubLogoDatabase || {}).forEach((club) => {
                const p = clubLogoDatabase[club];
                if (!p || !p.startsWith('logos/')) return;
                totalMapped++;
                const base64 = findBestLogoBase64ForClub(fileBase64ByNormName, club, p);
                if (base64) {
                    // EÄŸer mapping dosya adÄ±na gÃ¶re deÄŸil de kulÃ¼p adÄ±na gÃ¶re bulunduysa say
                    const mappedNorm = normalizeKey(baseNameFromPath(p).replace(/\.[^.]+$/, ''));
                    const byMapped = mappedNorm && fileBase64ByNormName[mappedNorm] === base64;
                    if (!byMapped) correctedByName++;
                    clubLogoBase64Database[club] = base64;
                    matched++;
                }
            });

            // Header logolarÄ± (ÃœÃœ / SKS)
            let uuOk = false;
            let sksOk = false;
            const uuKeys = ['uulogo', 'uu', 'uskudaruniversitesi', 'uskudar'];
            const sksKeys = ['skslogo', 'sks'];

            Object.keys(fileBase64ByNormName).forEach((norm) => {
                if (!uuOk && uuKeys.some(k => norm.includes(k))) {
                    localStorage.setItem('headerUULogoBase64', fileBase64ByNormName[norm]);
                    uuOk = true;
                }
                if (!sksOk && sksKeys.some(k => norm.includes(k))) {
                    localStorage.setItem('headerSKSLogoBase64', fileBase64ByNormName[norm]);
                    sksOk = true;
                }
            });

            // LocalStorage limiti aÅŸÄ±labilir â†’ IndexedDB'ye yaz (kalÄ±cÄ±) + LocalStorage'Ä± best-effort dene
            try {
                localStorage.setItem('clubLogoBase64Database', JSON.stringify(clubLogoBase64Database));
            } catch (e) {
                // Beklenen: QUOTA_EXCEEDED_ERR
                dwarn('LocalStorage base64 limiti aÅŸÄ±ldÄ±, IndexedDB kullanÄ±lacak:', e);
            }
            if (statusEl) statusEl.textContent = `â³ Kaydediliyor... (IndexedDB)`;
            try {
                await persistBase64LogosToIDB();
            } catch (e) {
                alert('âŒ Logo kaydÄ± (IndexedDB) baÅŸarÄ±sÄ±z. TarayÄ±cÄ± izinlerini kontrol edin.');
                throw e;
            }

            displayLogoMappings();
            if (statusEl) statusEl.textContent = `âœ… Toplu iÃ§e aktarÄ±ldÄ±: ${matched}/${totalMapped} kulÃ¼p (isimle dÃ¼zeltme: ${correctedByName}) + ÃœÃœ=${uuOk ? 'OK' : '-'} / SKS=${sksOk ? 'OK' : '-'}`;

            // Yeni base64 logolarÄ± mevcut etkinliklere uygula ve listeyi yenile
            refreshEventLogosFromDatabase();
            try { renderEvents(); } catch (_) {}

            alert(`âœ… Toplu iÃ§e aktarÄ±m tamamlandÄ±!\n\nKulÃ¼p logolarÄ± (base64): ${matched}/${totalMapped}\nÄ°simle dÃ¼zeltme: ${correctedByName}\nHeader: ÃœÃœ=${uuOk ? 'OK' : 'yok'} | SKS=${sksOk ? 'OK' : 'yok'}\n\nÅimdi â€œTasarÄ±ma DÃ¶nÃ¼ÅŸtÃ¼râ€ â†’ â€œTasarÄ±mÄ± Ä°ndirâ€ deneyin.`);
        }

        function renderHeaderLogoManagerPreviews() {
            const uuPreview = document.getElementById('headerUULogoPreview');
            const sksPreview = document.getElementById('headerSKSLogoPreview');
            if (!uuPreview || !sksPreview) return;

            const uu = localStorage.getItem('headerUULogoBase64');
            const sks = localStorage.getItem('headerSKSLogoBase64');

            uuPreview.innerHTML = uu && uu.startsWith('data:')
                ? `<img src="${uu}" alt="ÃœÃœ" style="width:100%; height:100%; object-fit:contain; display:block; background:white;">`
                : `<span style="color:#999; font-size:12px;">ÃœÃœ</span>`;

            sksPreview.innerHTML = sks && sks.startsWith('data:')
                ? `<img src="${sks}" alt="SKS" style="width:100%; height:100%; object-fit:contain; display:block; background:white;">`
                : `<span style="color:#999; font-size:12px;">SKS</span>`;
        }

        function handleHeaderLogoSelect(which, e) {
            const file = e?.target?.files?.[0];
            if (!file) return;
            if (!(file.type || '').startsWith('image/')) {
                alert('âŒ LÃ¼tfen bir resim dosyasÄ± seÃ§in (PNG/JPG).');
                return;
            }
            const reader = new FileReader();
            reader.onload = () => {
                const base64 = reader.result;
                if (typeof base64 !== 'string' || !base64.startsWith('data:')) {
                    alert('âŒ Logo okunamadÄ±.');
                    return;
                }
                if (which === 'uu') {
                    localStorage.setItem('headerUULogoBase64', base64);
                } else if (which === 'sks') {
                    localStorage.setItem('headerSKSLogoBase64', base64);
                }
                renderHeaderLogoManagerPreviews();
                alert('âœ… Header logo kaydedildi! Åimdi â€œTasarÄ±ma DÃ¶nÃ¼ÅŸtÃ¼râ€ yapabilirsiniz.');
            };
            reader.onerror = () => alert('âŒ Logo okunamadÄ±.');
            reader.readAsDataURL(file);
        }

        function clearHeaderLogos() {
            localStorage.removeItem('headerUULogoBase64');
            localStorage.removeItem('headerSKSLogoBase64');
            renderHeaderLogoManagerPreviews();
            alert('âœ… Header logolarÄ± temizlendi.');
        }

        function handleDragOver(e) {
            e.preventDefault();
            e.stopPropagation();
            const uploadArea = document.getElementById('logoUploadArea');
            uploadArea.style.background = '#e7f3ff';
            uploadArea.style.borderColor = '#1a5f5f';
        }
        
        function handleDragLeave(e) {
            e.preventDefault();
            e.stopPropagation();
            const uploadArea = document.getElementById('logoUploadArea');
            uploadArea.style.background = '#f8f9fa';
            uploadArea.style.borderColor = '#1a5f5f';
        }
        
        function handleLogoDrop(e) {
            e.preventDefault();
            e.stopPropagation();
            const uploadArea = document.getElementById('logoUploadArea');
            uploadArea.style.background = '#f8f9fa';
            uploadArea.style.borderColor = '#1a5f5f';
            
            const files = e.dataTransfer.files;
            if (files.length > 0) {
                processLogoFile(files[0]);
            }
        }
        
        function handleLogoFileSelect(e) {
            const file = e.target.files[0];
            if (file) {
                processLogoFile(file);
            }
        }
        
        function processLogoFile(file) {
            // Dosya tipi kontrolÃ¼
            if (!file.type.startsWith('image/')) {
                alert('âŒ LÃ¼tfen bir resim dosyasÄ± seÃ§in! (PNG, JPG)');
                return;
            }
            
            // Dosya boyutu kontrolÃ¼ (500 KB)
            if (file.size > 500 * 1024) {
                alert('âš ï¸ Dosya boyutu Ã§ok bÃ¼yÃ¼k! Maksimum 500 KB olmalÄ±.');
            }
            
            const reader = new FileReader();
            reader.onload = function(e) {
                const img = new Image();
                img.onload = function() {
                    // Logo bilgilerini gÃ¶ster
                    const logoInfo = document.getElementById('logoInfo');
                    logoInfo.style.display = 'block';
                    
                    document.getElementById('logoSizeInfo').textContent = `${img.width} x ${img.height} px`;
                    document.getElementById('logoFileSizeInfo').textContent = formatFileSize(file.size);
                    document.getElementById('logoFormatInfo').textContent = file.type.split('/')[1].toUpperCase();
                    
                    const ratio = (img.width / img.height).toFixed(2);
                    document.getElementById('logoRatioInfo').textContent = ratio + ':1';
                    
                    // Boyut uyarÄ±sÄ±
                    if (img.width !== img.height) {
                        document.getElementById('logoRatioInfo').style.color = '#dc3545';
                        document.getElementById('logoRatioInfo').innerHTML += ' âš ï¸ (Kare deÄŸil)';
                    } else {
                        document.getElementById('logoRatioInfo').style.color = '#28a745';
                    }
                    
                    if (img.width < 200 || img.height < 200) {
                        document.getElementById('logoSizeInfo').style.color = '#dc3545';
                        document.getElementById('logoSizeInfo').innerHTML += ' âš ï¸ (Ã‡ok kÃ¼Ã§Ã¼k)';
                    } else if (img.width > 512 || img.height > 512) {
                        document.getElementById('logoSizeInfo').style.color = '#ffc107';
                        document.getElementById('logoSizeInfo').innerHTML += ' âš ï¸ (BÃ¼yÃ¼k)';
                    } else {
                        document.getElementById('logoSizeInfo').style.color = '#28a745';
                    }
                    
                    // Ã–nizleme gÃ¶ster
                    const preview = document.getElementById('logoManagerPreview');
                    preview.innerHTML = `
                        <img src="${e.target.result}" alt="Logo" style="max-width: 200px; max-height: 200px; object-fit: contain; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                    `;
                    
                    // Base64'Ã¼ geÃ§ici olarak sakla (kaydet butonuna basÄ±ldÄ±ÄŸÄ±nda kaydedilecek)
                    const clubName = document.getElementById('logoManagerClubSelect').value;
                    if (clubName) {
                        // Base64'Ã¼ geÃ§ici olarak data attribute'da sakla
                        document.getElementById('logoManagerClubSelect').dataset.tempBase64 = e.target.result;
                        
                        const suggestedName = generateFileNameFromClubName(clubName, file.name);
                        document.getElementById('logoManagerFileName').value = suggestedName;
                    } else {
                        // Sadece dosya adÄ±nÄ± al (uzantÄ±yÄ± koru)
                        const fileName = file.name.replace(/\s+/g, '-').toLowerCase();
                        document.getElementById('logoManagerFileName').value = fileName;
                        // Base64'Ã¼ geÃ§ici olarak sakla
                        document.getElementById('logoManagerFileName').dataset.tempBase64 = e.target.result;
                    }
                    
                    // Upload alanÄ±nÄ± gÃ¼ncelle
                    const uploadArea = document.getElementById('logoUploadArea');
                    uploadArea.innerHTML = `
                        <div style="color: #28a745; font-weight: bold; margin-bottom: 10px;">âœ… Dosya seÃ§ildi: ${file.name}</div>
                        <div style="color: #666; font-size: 12px;">Yeni dosya yÃ¼klemek iÃ§in tekrar tÄ±klayÄ±n</div>
                    `;
                    uploadArea.onclick = function() {
                        const input = document.createElement('input');
                        input.type = 'file';
                        input.accept = 'image/png,image/jpeg,image/jpg';
                        input.style.display = 'none';
                        input.onchange = handleLogoFileSelect;
                        document.body.appendChild(input);
                        input.click();
                        document.body.removeChild(input);
                    };
                };
                img.src = e.target.result;
            };
            reader.readAsDataURL(file);
        }
        
        function formatFileSize(bytes) {
            if (bytes < 1024) return bytes + ' B';
            if (bytes < 1024 * 1024) return (bytes / 1024).toFixed(1) + ' KB';
            return (bytes / (1024 * 1024)).toFixed(1) + ' MB';
        }
        
        function generateFileNameFromClub() {
            const clubName = document.getElementById('logoManagerClubSelect').value;
            if (!clubName) {
                alert('LÃ¼tfen Ã¶nce bir kulÃ¼p seÃ§in!');
                return;
            }
            
            const fileName = generateFileNameFromClubName(clubName);
            document.getElementById('logoManagerFileName').value = fileName;
        }
        
        function generateFileNameFromClubName(clubName, originalFileName = '') {
            // TÃ¼rkÃ§e karakterleri deÄŸiÅŸtir
            const turkishMap = {
                'Ã§': 'c', 'ÄŸ': 'g', 'Ä±': 'i', 'Ã¶': 'o', 'ÅŸ': 's', 'Ã¼': 'u',
                'Ã‡': 'c', 'Ä': 'g', 'Ä°': 'i', 'Ã–': 'o', 'Å': 's', 'Ãœ': 'u'
            };
            
            let fileName = clubName
                .toLowerCase()
                .replace(/[Ã§ÄŸÄ±Ã¶ÅŸÃ¼Ã‡ÄÄ°Ã–ÅÃœ]/g, (char) => turkishMap[char] || char)
                .replace(/[^a-z0-9\s-]/g, '')
                .replace(/\s+/g, '-')
                .replace(/-+/g, '-')
                .replace(/^-|-$/g, '');
            
            // EÄŸer orijinal dosya adÄ± varsa uzantÄ±sÄ±nÄ± al
            if (originalFileName) {
                const ext = originalFileName.split('.').pop().toLowerCase();
                fileName += '.' + ext;
            } else {
                fileName += '.png';
            }
            
            return fileName;
        }
        
        function updateLogoManagerPreview(logoPath) {
            const preview = document.getElementById('logoManagerPreview');
            if (!preview) return;
            
            const encodedPath = encodeURI(logoPath);
            preview.innerHTML = `
                <img src="${encodedPath}" alt="Logo" style="max-width: 200px; max-height: 200px; object-fit: contain; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);" onload="this.onerror=null;" onerror="this.style.display='none'; this.nextElementSibling.style.display='block';">
                <span style="color: #dc3545; display: none;">âŒ Logo bulunamadÄ±! Dosya adÄ±nÄ± kontrol edin veya logos/ klasÃ¶rÃ¼ne ekleyin.</span>
            `;
            
            // Logo bilgilerini gizle (dosya yÃ¼kleme ile gÃ¶sterilir)
            document.getElementById('logoInfo').style.display = 'none';
        }
        
        function saveLogoMapping() {
            const clubName = document.getElementById('logoManagerClubSelect').value;
            const fileName = document.getElementById('logoManagerFileName').value.trim();
            
            if (!clubName) {
                alert('LÃ¼tfen bir kulÃ¼p seÃ§in!');
                return;
            }
            
            if (!fileName) {
                alert('LÃ¼tfen logo dosya adÄ±nÄ± girin!');
                return;
            }
            
            // Logo path'ini oluÅŸtur
            const logoPath = 'logos/' + fileName;
            
            // VeritabanÄ±na ekle/gÃ¼ncelle
            clubLogoDatabase[clubName] = logoPath;
            
            // Base64 varsa kaydet (yÃ¼klenen dosyadan)
            const clubSelect = document.getElementById('logoManagerClubSelect');
            const fileNameInput = document.getElementById('logoManagerFileName');
            const base64 = clubSelect.dataset.tempBase64 || fileNameInput.dataset.tempBase64;
            
            if (base64) {
                clubLogoBase64Database[clubName] = base64;
                // LocalStorage'a base64'Ã¼ kaydet
                localStorage.setItem('clubLogoBase64Database', JSON.stringify(clubLogoBase64Database));
                // GeÃ§ici base64'Ã¼ temizle
                delete clubSelect.dataset.tempBase64;
                delete fileNameInput.dataset.tempBase64;
            }
            
            // LocalStorage'a kaydet
            localStorage.setItem('clubLogoDatabase', JSON.stringify(clubLogoDatabase));
            
            alert(`âœ… Logo eÅŸleÅŸtirmesi kaydedildi!\n\nKulÃ¼p: ${clubName}\nLogo: ${logoPath}\n\n${base64 ? 'ğŸ“¦ Logo base64 olarak da kaydedildi (GitHub Pages iÃ§in)' : 'ğŸ’¡ Logo dosyasÄ±nÄ± logos/ klasÃ¶rÃ¼ne eklemeyi unutmayÄ±n!'}`);
            
            // Listeyi gÃ¼ncelle
            displayLogoMappings();
            
            // Logo preview'u gÃ¼ncelle
            updateLogoPreview(clubName);
        }
        
        // logos.json dosyasÄ±ndan logolarÄ± yÃ¼kle (GitHub Pages iÃ§in)
        async function loadLogosFromJSON() {
            try {
                const response = await fetch('logos.json');
                if (response.ok) {
                    const data = await response.json();
                    // KulÃ¼p listesi: seÃ§imde sadece resmÃ® liste kullanÄ±lacak.
                    clubNames = [...OFFICIAL_CLUB_NAMES];
                    
                    if (data.logos && Object.keys(data.logos).length > 0) {
                        // Base64 logolarÄ± yÃ¼kle (logos.json'dan gelenler Ã¶ncelikli)
                        Object.keys(data.logos).forEach((club) => {
                            const canon = canonicalizeClubName(club);
                            if (canon && data.logos[club]) {
                                clubLogoBase64Database[canon] = data.logos[club];
                            }
                        });
                        console.log(`âœ… ${Object.keys(data.logos).length} base64 logo yÃ¼klendi`);
                    }
                    if (data.mappings && Object.keys(data.mappings).length > 0) {
                        // Logo eÅŸleÅŸtirmelerini yÃ¼kle (logos.json'dan gelenler Ã¶ncelikli)
                        Object.keys(data.mappings).forEach((club) => {
                            const canon = canonicalizeClubName(club);
                            if (canon && data.mappings[club]) {
                                clubLogoDatabase[canon] = data.mappings[club];
                            }
                        });
                        console.log(`âœ… ${Object.keys(data.mappings).length} logo eÅŸleÅŸtirmesi yÃ¼klendi`);
                    }

                    // Header logolarÄ±nÄ± yÃ¼kle (ÃœÃœ / SKS)
                    if (data.header) {
                        if (data.header.uu && typeof data.header.uu === 'string' && data.header.uu.startsWith('data:')) {
                            localStorage.setItem('headerUULogoBase64', data.header.uu);
                        }
                        if (data.header.sks && typeof data.header.sks === 'string' && data.header.sks.startsWith('data:')) {
                            localStorage.setItem('headerSKSLogoBase64', data.header.sks);
                        }
                    }
                }
            } catch (e) {
                console.log('â„¹ï¸ logos.json dosyasÄ± bulunamadÄ± (normal, ilk kullanÄ±mda olmayabilir)');
            }
        }
        
        // LocalStorage'dan logo veritabanÄ±nÄ± yÃ¼kle
        function loadLogoDatabase() {
            // Ã–nce baÅŸlangÄ±Ã§ veritabanÄ±nÄ± koru, sonra LocalStorage'dan ekle
            const saved = localStorage.getItem('clubLogoDatabase');
            if (saved) {
                try {
                    const savedDatabase = JSON.parse(saved);
                    // LocalStorage'dan gelen verileri ekle (sadece baÅŸlangÄ±Ã§ veritabanÄ±nda olmayanlar)
                    Object.keys(savedDatabase).forEach((club) => {
                        const canon = canonicalizeClubName(club);
                        if (!canon) return;
                        // EÄŸer baÅŸlangÄ±Ã§ veritabanÄ±nda yoksa veya LocalStorage'daki path geÃ§erliyse ekle
                        if (savedDatabase[club] && (!clubLogoDatabase[canon] || savedDatabase[club].startsWith('data:'))) {
                            clubLogoDatabase[canon] = savedDatabase[club];
                        }
                    });
                } catch (e) {
                    console.warn('Logo veritabanÄ± yÃ¼klenemedi:', e);
                }
            }
            
            // Base64 veritabanÄ±nÄ± yÃ¼kle (LocalStorage'dan)
            const savedBase64 = localStorage.getItem('clubLogoBase64Database');
            if (savedBase64) {
                try {
                    const localBase64 = JSON.parse(savedBase64);
                    // LocalStorage'dan gelen base64 logolarÄ± ekle
                    Object.keys(localBase64).forEach((club) => {
                        const canon = canonicalizeClubName(club);
                        if (!canon) return;
                        if (localBase64[club]) {
                            clubLogoBase64Database[canon] = localBase64[club];
                        }
                    });
                } catch (e) {
                    console.warn('Base64 logo veritabanÄ± yÃ¼klenemedi:', e);
                }
            }
        }
        
        // LogolarÄ± JSON dosyasÄ±na export et
        function exportLogosToJSON() {
            const exportData = {
                version: '1.0',
                exportDate: new Date().toISOString(),
                clubNames: clubNames,
                logos: clubLogoBase64Database,
                mappings: clubLogoDatabase,
                header: {
                    uu: localStorage.getItem('headerUULogoBase64') || null,
                    sks: localStorage.getItem('headerSKSLogoBase64') || null
                }
            };
            
            const jsonString = JSON.stringify(exportData, null, 2);
            const blob = new Blob([jsonString], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'logos.json';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            const headerUu = exportData.header.uu ? 'var' : 'yok';
            const headerSks = exportData.header.sks ? 'var' : 'yok';
            alert(`âœ… logos.json dosyasÄ± indirildi!\n\nğŸ“¦ Ä°Ã§erik:\n- ${clubNames.length} kulÃ¼p adÄ±\n- ${Object.keys(clubLogoBase64Database).length} base64 logo\n- ${Object.keys(clubLogoDatabase).length} logo eÅŸleÅŸtirmesi\n- Header ÃœÃœ: ${headerUu}\n- Header SKS: ${headerSks}\n\nğŸ“¦ GitHub'a yÃ¼kleme:\n1. Ä°ndirilen logos.json dosyasÄ±nÄ± ana dizine koyun\n2. GitHub repository'nize yÃ¼kleyin\n3. Herkes aynÄ± logolarÄ± ve kulÃ¼p listesini gÃ¶rebilecek!`);
        }
        
        // Logo gÃ¶sterim fonksiyonu - Ã¶nce logos/ klasÃ¶rÃ¼nden dener, yoksa base64 kullanÄ±r
        function getLogoSource(clubName) {
            if (!clubName) {
                return null;
            }
            
            // Ã–nce resmÃ® isme Ã§evir (mÃ¼mkÃ¼nse)
            const raw = clubName.trim();
            const canon = canonicalizeClubName(raw) || raw;
            const candidates = [canon, raw];
            // Canon iÃ§in eski alias anahtarlarÄ±nÄ± da dene (geriye dÃ¶nÃ¼k)
            if (canon) {
                Object.keys(CLUB_NAME_ALIASES).forEach((k) => {
                    if (CLUB_NAME_ALIASES[k] === canon) candidates.push(k);
                });
            }
            const uniq = [...new Set(candidates.filter(Boolean).map(s => s.trim()).filter(Boolean))];
            
            // Ã–nce base64 veritabanÄ±nda kontrol et
            for (const name of uniq) {
                if (clubLogoBase64Database && clubLogoBase64Database[name]) {
                    console.log('Base64 logo bulundu:', name);
                    return clubLogoBase64Database[name];
                }
            }
            
            // Sonra logo path veritabanÄ±nda kontrol et (tam eÅŸleÅŸme)
            for (const name of uniq) {
                if (clubLogoDatabase && clubLogoDatabase[name]) {
                    const logoPath = clubLogoDatabase[name];
                    console.log('Logo path bulundu (tam eÅŸleÅŸme):', name, '->', logoPath);
                    return logoPath;
                }
            }
            
            // Tam eÅŸleÅŸme yoksa, bÃ¼yÃ¼k/kÃ¼Ã§Ã¼k harf duyarsÄ±z tam eÅŸleÅŸme dene
            if (clubLogoDatabase) {
                const uniqLower = uniq.map(s => s.toLowerCase().trim());
                for (const key in clubLogoDatabase) {
                    const keyLower = (key || '').toLowerCase().trim();
                    if (uniqLower.includes(keyLower)) {
                        const logoPath = clubLogoDatabase[key];
                        console.log('Logo path bulundu (bÃ¼yÃ¼k/kÃ¼Ã§Ã¼k harf duyarsÄ±z):', canon, '->', key, '->', logoPath);
                        return logoPath;
                    }
                }
            }
            
            console.log('Logo bulunamadÄ±:', canon);
            console.log('Mevcut kulÃ¼pler:', Object.keys(clubLogoDatabase || {}).slice(0, 10));
            console.log('Aranan isim:', canon);
            
            // HiÃ§biri yoksa null dÃ¶ndÃ¼r (emoji gÃ¶sterilecek)
            return null;
        }

        // Mevcut logo veritabanÄ±na gÃ¶re etkinliklerdeki clubIcon alanÄ±nÄ± gÃ¼ncelle
        // (Logo veritabanÄ± sonradan deÄŸiÅŸtiÄŸinde "liste" ile "tasarÄ±ma dÃ¶nÃ¼ÅŸtÃ¼r" aynÄ± logoyu kullansÄ±n)
        function refreshEventLogosFromDatabase() {
            try {
                Object.values(events || {}).forEach(day => {
                    if (!day || !Array.isArray(day.events)) return;
                    day.events.forEach(ev => {
                        if (!ev || !ev.clubName) return;
                        const src = getLogoSource(ev.clubName);
                        if (src) {
                            ev.clubIcon = src;
                        }
                    });
                });
            } catch (_) {}
        }
        
        function displayLogoMappings() {
            const list = document.getElementById('logoMappingsList');
            if (!list) return;
            
            list.innerHTML = '';
            
            // KulÃ¼p isimlerine gÃ¶re sÄ±rala
            const sortedClubs = Object.keys(clubLogoDatabase).sort();
            
            sortedClubs.forEach(club => {
                const logoPath = clubLogoDatabase[club];
                const fileName = logoPath.replace('logos/', '');
                
                const item = document.createElement('div');
                item.style.cssText = 'padding: 10px; margin-bottom: 8px; background: #f8f9fa; border-radius: 6px; display: flex; justify-content: space-between; align-items: center;';
                item.innerHTML = `
                    <div style="flex: 1;">
                        <div style="font-weight: bold; color: #1a5f5f; font-size: 13px;">${club}</div>
                        <div style="color: #666; font-size: 11px; margin-top: 3px;">${fileName}</div>
                    </div>
                    <div style="width: 50px; height: 50px; background: white; border-radius: 6px; display: flex; align-items: center; justify-content: center; margin-left: 10px; border: 1px solid #e0e0e0;">
                        <img src="${encodeURI(logoPath)}" alt="Logo" style="max-width: 45px; max-height: 45px; object-fit: contain;" onerror="this.style.display='none'; this.nextElementSibling.style.display='block';">
                        <span style="font-size: 24px; display: none;">ğŸ¯</span>
                    </div>
                `;
                list.appendChild(item);
            });
        }
        
        // Modal dÄ±ÅŸÄ±na tÄ±klanÄ±nca kapat
        document.addEventListener('click', (e) => {
            const modal = document.getElementById('logoManagerModal');
            if (modal && e.target === modal) {
                closeLogoManager();
            }
        });
        
        // KulÃ¼p YÃ¶netimi FonksiyonlarÄ±
        function loadClubNames() {
            // SeÃ§im listesi her zaman resmÃ® listedir.
            clubNames = [...OFFICIAL_CLUB_NAMES];
        }
        
        function saveClubNames() {
            localStorage.setItem('clubNames', JSON.stringify(clubNames));
        }
        
        function showAddClubModal(editMode = false, oldName = '') {
            const modal = document.getElementById('addClubModal');
            const title = document.getElementById('addClubModalTitle');
            const input = document.getElementById('newClubName');
            
            if (editMode) {
                title.textContent = 'âœï¸ KulÃ¼p DÃ¼zenle';
                input.value = oldName;
                input.dataset.oldName = oldName;
            } else {
                title.textContent = 'â• Yeni KulÃ¼p Ekle';
                input.value = '';
                delete input.dataset.oldName;
            }
            
            modal.style.display = 'flex';
            input.focus();
        }
        
        function closeAddClubModal() {
            document.getElementById('addClubModal').style.display = 'none';
            document.getElementById('newClubName').value = '';
        }
        
        function saveNewClub() {
            const input = document.getElementById('newClubName');
            const newName = input.value.trim();
            const oldName = input.dataset.oldName;
            
            if (!newName) {
                alert('âŒ LÃ¼tfen kulÃ¼p adÄ± girin!');
                return;
            }
            
            // ResmÃ® liste dÄ±ÅŸÄ±na Ã§Ä±kmayÄ± engelle
            const canon = canonicalizeClubName(newName);
            if (!canon) {
                alert('âŒ Bu isim resmÃ® kulÃ¼p listesinde yok.\n\nLÃ¼tfen resmÃ® listeden bir kulÃ¼p adÄ± seÃ§in/kopyalayÄ±n.');
                return;
            }
            
            if (oldName) {
                // DÃ¼zenleme modu
                if (oldName === canon) {
                    closeAddClubModal();
                    return;
                }
                
                // Eski adÄ± yeni adla deÄŸiÅŸtir
                const index = clubNames.indexOf(oldName);
                if (index !== -1) {
                    clubNames[index] = canon;
                    
                    // Logo veritabanÄ±nÄ± gÃ¼ncelle
                    if (clubLogoDatabase[oldName]) {
                        clubLogoDatabase[canon] = clubLogoDatabase[oldName];
                        delete clubLogoDatabase[oldName];
                    }
                    if (clubLogoBase64Database[oldName]) {
                        clubLogoBase64Database[canon] = clubLogoBase64Database[oldName];
                        delete clubLogoBase64Database[oldName];
                    }
                    
                    // LocalStorage'Ä± gÃ¼ncelle
                    localStorage.setItem('clubLogoDatabase', JSON.stringify(clubLogoDatabase));
                    localStorage.setItem('clubLogoBase64Database', JSON.stringify(clubLogoBase64Database));
                    
                    alert(`âœ… KulÃ¼p adÄ± gÃ¼ncellendi!\n\nEski: ${oldName}\nYeni: ${canon}`);
                }
            } else {
                // Yeni ekleme modu
                if (clubNames.includes(canon)) {
                    alert('âš ï¸ Bu kulÃ¼p zaten listede var!');
                    return;
                }
                
                clubNames.push(canon);
                alert(`âœ… Yeni kulÃ¼p eklendi: ${canon}`);
            }
            
            saveClubNames();
            closeAddClubModal();
            
            // Logo yÃ¶netim panelini yenile
            if (document.getElementById('logoManagerModal').style.display === 'flex') {
                openLogoManager();
            }
            
            // Ana formu yenile
            initClubList();
        }
        
        function editSelectedClub() {
            const select = document.getElementById('logoManagerClubSelect');
            const selectedClub = select.value;
            
            if (!selectedClub) {
                alert('âŒ LÃ¼tfen dÃ¼zenlemek iÃ§in bir kulÃ¼p seÃ§in!');
                return;
            }
            
            showAddClubModal(true, selectedClub);
        }
        
        function deleteSelectedClub() {
            const select = document.getElementById('logoManagerClubSelect');
            const selectedClub = select.value;
            
            if (!selectedClub) {
                alert('âŒ LÃ¼tfen silmek iÃ§in bir kulÃ¼p seÃ§in!');
                return;
            }
            
            if (!confirm(`âš ï¸ "${selectedClub}" kulÃ¼bÃ¼nÃ¼ silmek istediÄŸinize emin misiniz?\n\nBu iÅŸlem geri alÄ±namaz!`)) {
                return;
            }
            
            // KulÃ¼p listesinden sil
            const index = clubNames.indexOf(selectedClub);
            if (index !== -1) {
                clubNames.splice(index, 1);
                saveClubNames();
            }
            
            // Logo veritabanÄ±ndan sil (opsiyonel - kullanÄ±cÄ±ya sor)
            if (clubLogoDatabase[selectedClub] || clubLogoBase64Database[selectedClub]) {
                if (confirm('Logo verilerini de silmek ister misiniz?')) {
                    delete clubLogoDatabase[selectedClub];
                    delete clubLogoBase64Database[selectedClub];
                    localStorage.setItem('clubLogoDatabase', JSON.stringify(clubLogoDatabase));
                    localStorage.setItem('clubLogoBase64Database', JSON.stringify(clubLogoBase64Database));
                }
            }
            
            alert(`âœ… "${selectedClub}" kulÃ¼bÃ¼ silindi!`);
            
            // Logo yÃ¶netim panelini yenile
            if (document.getElementById('logoManagerModal').style.display === 'flex') {
                openLogoManager();
            }
            
            // Ana formu yenile
            initClubList();
        }
        
        // Modal dÄ±ÅŸÄ±na tÄ±klanÄ±nca kapat
        document.addEventListener('click', (e) => {
            const addClubModal = document.getElementById('addClubModal');
            if (addClubModal && e.target === addClubModal) {
                closeAddClubModal();
            }
        });
        
        window.onload = async function() {
            // Ã–nce logos.json dosyasÄ±ndan yÃ¼kle (GitHub Pages iÃ§in)
            await loadLogosFromJSON();

            // PaylaÅŸÄ±mlÄ± kullanÄ±m: varsa events-data.json'dan yÃ¼kle (seed)
            await loadEventsFromJSON();
            
            // Sonra LocalStorage'dan yÃ¼kle (kullanÄ±cÄ± Ã¶zel logolarÄ± iÃ§in)
            loadLogoDatabase();

            // BÃ¼yÃ¼k base64 setleri iÃ§in IndexedDB'den de yÃ¼kle
            await loadBase64LogosFromIDB();
            
            // KulÃ¼p listesini yÃ¼kle
            loadClubNames();
            
            initClubList();
            setupClubAutoSelect();
            initTimeSelector();
            setupEventsAutoSave();

            // Mevcut haftayÄ± giriÅŸ alanlarÄ±ndan set et (local/bulut keyâ€™leri iÃ§in)
            try {
                currentWeekState = getWeekStateFromInputs();
                currentWeekKey = computeWeekKey(currentWeekState);
            } catch (_) {}

            // Etkinlikleri localStorage'dan geri yÃ¼kle (varsa)
            const restored = loadEventsStateFromStorage();

            // YÃ¼kleme sonrasÄ± mevcut etkinlikler varsa logolarÄ± gÃ¼ncelle ve listeyi yenile
            refreshEventLogosFromDatabase();
            try { renderEvents(); } catch (_) {}
            if (restored) {
                // EÄŸer gÃ¼n seÃ§iliyse, o gÃ¼n iÃ§in kaydedilmiÅŸ tarihi otomatik doldur
                try { suggestDateForDay(); } catch (_) {}
            }

            // Bulut senkron UI'Ä±nÄ± localStorage'daki ayarlarla doldur
            try {
                const cfg = getSupabaseConfig();
                const urlEl = document.getElementById('supabaseUrl');
                const keyEl = document.getElementById('supabaseAnonKey');
                if (urlEl) urlEl.value = cfg.url || '';
                if (keyEl) keyEl.value = cfg.anonKey || '';
                const autoEl = document.getElementById('cloudAutoSync');
                if (autoEl) autoEl.checked = !!cfg.auto;
                if (cfg.auto) setCloudStatus('ğŸ” Otomatik senkron aÃ§Ä±k');
                updateCloudAuthStatusUI();
            } catch (_) {}

            // Otomatik senkron aÃ§Ä±ksa bu haftayÄ± bulutla otomatik eÅŸitle
            try { await cloudAutoSyncResolveForWeek(); } catch (_) {}
        };
    </script>
</body>
</html>